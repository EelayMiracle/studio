<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тренажер математических примеров в столбик</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 15px;
            text-align: center;
        }

        /* Фоновое изображение с затемнением */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.1)),
                url('img/f1.jpg') center/cover no-repeat;
            z-index: -2;
        }

        /* Поверх фонового изображения добавим ваш градиент с прозрачностью */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(110, 142, 251, 0.8), rgba(167, 119, 227, 0.3));
            z-index: -1;
        }

        .container {
            width: 100%;
            background-color: rgba(222, 158, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        h1, h2, h3 {
            text-align: center;
            margin-bottom: 15px;
            color: #333;
            font-size: clamp(1.3rem, 4vw, 1.8rem);
        }

        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.5);
        }

        .settings-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            align-items: flex-start;
        }

        .labels-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            flex: 1;
            max-width: 200px;
        }

        .setting-label {
            font-weight: bold;
            color: #333;
            text-align: right;
            padding: 8px 0;
            height: 40px;
            line-height: 24px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }

        .inputs-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            flex: 0 0 auto;
        }

        .inputs-container select, .inputs-container input {
            padding: 8px 10px;
            font-size: 16px;
            border: 2px solid #000000;
            border-radius: 50px;
            background-color: rgba(255, 255, 255, 0.9);
            text-align: center;
            height: 40px;
            box-sizing: border-box;
            width: 80px;
        }

        .buttons-row {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .buttons-row button {
            padding: 12px 20px;
            font-size: 16px;
            cursor: pointer;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 50px;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            font-weight: bold;
            min-width: 120px;
            margin: 5px;
            width: auto;
            flex: 1;
            max-width: 200px;
        }

        .buttons-row button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .math-example {
            font-family: 'Courier New', monospace;
            font-size: 24px;
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            min-height: 150px;
            border: 2px solid rgba(255, 255, 255, 0.5);
        }

        .number-slot {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 2px solid #1a5276;
            margin: 0 5px;
            text-align: center;
            line-height: 40px;
            cursor: pointer;
            background: white;
            border-radius: 50%;
            vertical-align: top;
            font-weight: bold;
            font-size: 18px;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .number-slot.empty {
            background: rgba(255, 255, 255, 0.5);
            border: 2px dashed #666;
        }

        .number-slot.draggable {
            cursor: grab;
            background: white;
            border-color: #1a5276;
        }

        .number-slot.draggable:hover {
            background: #f8f9fa;
            transform: scale(1.1);
        }

        .operation {
            display: inline-block;
            width: 30px;
            text-align: center;
            margin: 0 5px;
            vertical-align: top;
            font-weight: bold;
            font-size: 20px;
        }

        .equals {
            display: inline-block;
            width: 30px;
            text-align: center;
            margin: 0 5px;
        }

        .pool {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            min-height: 60px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            border: 2px solid rgba(255, 255, 255, 0.5);
        }

        .pool-number {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 2px solid #1a5276;
            text-align: center;
            line-height: 50px;
            cursor: grab;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border-radius: 50%;
            font-weight: bold;
            font-size: 20px;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .pool-number:hover {
            background: linear-gradient(135deg, #2980b9, #1a5276);
            transform: scale(1.1);
        }

        .correct {
            background: linear-gradient(135deg, #a0e7a0, #80c080) !important;
            color: white;
            border-color: #4CAF50 !important;
        }

        .incorrect {
            background: linear-gradient(135deg, #f08080, #d06060) !important;
            color: white;
            border-color: #e74c3c !important;
        }

        .line {
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
        }

        .number-container {
            display: flex;
            align-items: center;
            gap: 5px;
            justify-content: flex-end;
        }

        .operation-container {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            width: 30px;
        }

        .example-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .example-line {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            gap: 20px;
        }

        .operation-column {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            width: 50px;
            height: 40px;
        }

        .number-column {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            min-width: 200px;
        }

        .number-line {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            min-width: 200px;
        }

        .operation-line {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            min-width: 200px;
        }

        .operation-slot {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 2px solid #1a5276;
            text-align: center;
            line-height: 40px;
            background: white;
            border-radius: 50%;
            vertical-align: top;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .second-line-container {
            display: flex;
            align-items: center;
        }

        .number-slot.invisible {
            visibility: hidden;
        }

        .underline {
            border-bottom: 2px solid #333;
            margin-top: 5px;
            display: flex;
            justify-content: center;
        }

        .instructions {
            background: rgba(255, 243, 205, 0.9);
            border: 1px solid rgba(255, 234, 167, 0.8);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            color: #856404;
        }
        .back-button {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            font-size: 24px;
            border-radius: 50%;
            text-decoration: none;
            margin: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border: none;
        }

        .back-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        

        /* Медиа-запросы для адаптивности */
        @media (min-width: 768px) {
            body {
                padding: 20px;
            }
            
            .container {
                padding: 25px;
            }
            
            .control-group {
                flex-direction: row;
                justify-content: center;
            }
            
            .control-group label {
                min-width: 150px;
                text-align: right;
                margin-bottom: 0;
                width: auto;
            }
            
            .control-group select, .control-group input {
                width: auto;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .number-slot {
                width: 35px;
                height: 35px;
                line-height: 35px;
                font-size: 16px;
                margin: 0 3px;
            }
            
            .pool-number {
                width: 45px;
                height: 45px;
                line-height: 45px;
                font-size: 18px;
            }
            
            .math-example {
                font-size: 20px;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Тренажер математических примеров в столбик  <a href="index.html" class="back-button">←</a></h1>
        
        <div class="controls">
            <div class="settings-container">
                <div class="labels-container">
                    <div class="setting-label">Первое число (знаков):</div>
                    <div class="setting-label">Операция:</div>
                    <div class="setting-label">Второе число (знаков):</div>
                    <div class="setting-label">Случайно убрать цифр:</div>
                </div>
                
                <div class="inputs-container">
                    <select id="firstDigits">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3" selected>3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                    
                    <select id="operation">
                        <option value="+">+</option>
                        <option value="-" selected>-</option>
                        <option value="×">×</option>
                    </select>
                    
                    <select id="secondDigits">
                        <option value="1">1</option>
                        <option value="2" selected>2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                    
                    <input type="number" id="autoRemove" value="0" min="0" max="20" step="1">
                </div>
            </div>
            
            <div class="buttons-row">
                <button onclick="generateExample()">Новый</button>
                <button onclick="showAnswer()">Показать ответ</button>
            </div>
        </div>
        
        <div class="math-example" id="mathExample">
            <!-- Пример будет генерироваться здесь -->
        </div>
        
        <div class="pool" id="numberPool">
            <!-- Пул чисел будет здесь -->
        </div>
    </div>

    <script>
        let currentExample = null;
        let draggedNumber = null;
        
        function generateExample() {
            console.log("Функция generateExample вызвана");
            
            try {
                const firstDigits = parseInt(document.getElementById('firstDigits').value);
                const secondDigits = parseInt(document.getElementById('secondDigits').value);
                const operation = document.getElementById('operation').value;
                const autoRemove = parseInt(document.getElementById('autoRemove').value);
                
                console.log("Параметры:", { firstDigits, secondDigits, operation, autoRemove });
                
                // Генерируем числа
                let firstNumber = generateRandomNumber(firstDigits);
                let secondNumber;
                
                // Для умножения на однозначное число - второй множитель всегда однозначный
                if (operation === '×') {
                    secondNumber = generateRandomNumber(1); // Всегда однозначное число
                } else {
                    secondNumber = generateRandomNumber(secondDigits);
                }
                
                console.log("Сгенерированные числа:", { firstNumber, secondNumber });
                
                // Для вычитания убедимся, что первое число больше второго
                if (operation === '-' && firstNumber < secondNumber) {
                    [firstNumber, secondNumber] = [secondNumber, firstNumber];
                    console.log("Числа поменяны местами для вычитания:", { firstNumber, secondNumber });
                }
                
                let result;
                if (operation === '+') {
                    result = firstNumber + secondNumber;
                } else if (operation === '-') {
                    result = firstNumber - secondNumber;
                } else if (operation === '×') {
                    result = firstNumber * secondNumber;
                }
                
                console.log("Результат:", result);
                
                currentExample = {
                    firstNumber,
                    secondNumber,
                    operation,
                    result,
                    firstDigits,
                    secondDigits,
                    resultDigits: result.toString().length
                };
                
                console.log("Текущий пример:", currentExample);
                
                renderExample();
                
                // Автоматически убираем случайные цифры
                if (autoRemove > 0) {
                    console.log("Автоматическое удаление", autoRemove, "цифр");
                    setTimeout(() => removeRandomNumbers(autoRemove), 100);
                }
                
                console.log("Генерация примера завершена успешно");
            } catch (error) {
                console.error("Ошибка в generateExample:", error);
                alert("Произошла ошибка при генерации примера. Проверьте консоль для подробностей.");
            }
        }
        
        function generateRandomNumber(digits) {
            const min = Math.pow(10, digits - 1);
            const max = Math.pow(10, digits) - 1;
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        
        function renderExample() {
            const exampleDiv = document.getElementById('mathExample');
            const poolDiv = document.getElementById('numberPool');
            
            exampleDiv.innerHTML = '';
            poolDiv.innerHTML = '';
            
            if (!currentExample) return;
            
            const { firstNumber, secondNumber, operation, result, firstDigits, secondDigits, resultDigits } = currentExample;
            
            const maxDigits = Math.max(firstDigits, secondDigits + 1);
            
            // Создаем контейнер для всего примера
            const exampleContainer = document.createElement('div');
            exampleContainer.className = 'example-container';
            
            // Первое число
            const firstLine = document.createElement('div');
            firstLine.className = 'example-line';
            
            // Колонка операции (пустая для первой строки)
            const firstOperationColumn = document.createElement('div');
            firstOperationColumn.className = 'operation-column';
            
            // Колонка числа
            const firstNumberColumn = document.createElement('div');
            firstNumberColumn.className = 'number-column';
            firstNumberColumn.innerHTML = createNumberSlots(firstNumber.toString(), 'first', maxDigits);
            
            firstLine.appendChild(firstOperationColumn);
            firstLine.appendChild(firstNumberColumn);
            exampleContainer.appendChild(firstLine);
            
            // Второе число с операцией
            const secondLine = document.createElement('div');
            secondLine.className = 'example-line';
            
            // Колонка операции
            const secondOperationColumn = document.createElement('div');
            secondOperationColumn.className = 'operation-column';
            secondOperationColumn.innerHTML = `<div class="operation-slot">${operation}</div>`;
            
            // Колонка числа
            const secondNumberColumn = document.createElement('div');
            secondNumberColumn.className = 'number-column';
            secondNumberColumn.innerHTML = createNumberSlots(secondNumber.toString(), 'second', maxDigits);
            
            secondLine.appendChild(secondOperationColumn);
            secondLine.appendChild(secondNumberColumn);
            exampleContainer.appendChild(secondLine);
            
            // Линия
            const underlineLine = document.createElement('div');
            underlineLine.className = 'example-line';
            
            // Колонка операции (пустая для линии)
            const underlineOperationColumn = document.createElement('div');
            underlineOperationColumn.className = 'operation-column';
            
            // Колонка линии
            const underlineColumn = document.createElement('div');
            underlineColumn.className = 'number-column';
            const underline = document.createElement('div');
            underline.className = 'underline';
            underline.style.width = (maxDigits * 50) + 'px';
            underlineColumn.appendChild(underline);
            
            underlineLine.appendChild(underlineOperationColumn);
            underlineLine.appendChild(underlineColumn);
            exampleContainer.appendChild(underlineLine);
            
            // Результат
            const resultLine = document.createElement('div');
            resultLine.className = 'example-line';
            
            // Колонка операции (пустая для результата)
            const resultOperationColumn = document.createElement('div');
            resultOperationColumn.className = 'operation-column';
            
            // Колонка числа
            const resultNumberColumn = document.createElement('div');
            resultNumberColumn.className = 'number-column';
            resultNumberColumn.innerHTML = createNumberSlots(result.toString(), 'result', maxDigits);
            
            resultLine.appendChild(resultOperationColumn);
            resultLine.appendChild(resultNumberColumn);
            exampleContainer.appendChild(resultLine);
            
            exampleDiv.appendChild(exampleContainer);
            
            // Добавляем обработчики событий для слотов
            addSlotEventListeners();
        }
        
        function createNumberSlots(numberStr, type, maxDigits) {
            let html = '';
            const currentDigits = numberStr.length;
            
            // Добавляем пустые слоты для выравнивания по правому краю
            for (let i = 0; i < maxDigits - currentDigits; i++) {
                html += `<div class="number-slot empty invisible"></div>`;
            }
            
            // Добавляем реальные цифры
            for (let i = 0; i < currentDigits; i++) {
                const digit = numberStr[i];
                html += `<div class="number-slot draggable" data-type="${type}" data-position="${i}" data-digit="${digit}">${digit}</div>`;
            }
            return html;
        }
        
        function addSlotEventListeners() {
            const slots = document.querySelectorAll('.number-slot.draggable');
            slots.forEach(slot => {
                slot.addEventListener('click', handleSlotClick);
                slot.addEventListener('dragstart', handleDragStart);
                slot.addEventListener('dragover', handleDragOver);
                slot.addEventListener('drop', handleDrop);
            });
            
            const emptySlots = document.querySelectorAll('.number-slot.empty');
            emptySlots.forEach(slot => {
                slot.addEventListener('dragover', handleDragOver);
                slot.addEventListener('drop', handleDrop);
                // Полностью отключаем клик на пустые слоты
                slot.onclick = null;
                slot.style.cursor = 'default';
                slot.style.pointerEvents = 'none';
            });
        }
        
        function handleSlotClick(event) {
            const slot = event.target;
            const digit = slot.getAttribute('data-digit');
            const type = slot.getAttribute('data-type');
            const position = slot.getAttribute('data-position');
            
            // Убираем цифру в пул
            slot.classList.remove('draggable');
            slot.classList.add('empty');
            slot.textContent = '';
            slot.removeAttribute('data-digit');
            
            // Добавляем цифру в пул
            addNumberToPool(digit);
            
            checkSolution();
        }
        
        function addNumberToPool(digit) {
            const poolDiv = document.getElementById('numberPool');
            const numberElement = document.createElement('div');
            numberElement.className = 'pool-number';
            numberElement.textContent = digit;
            numberElement.setAttribute('draggable', 'true');
            numberElement.setAttribute('data-digit', digit);
            
            numberElement.addEventListener('dragstart', (e) => {
                draggedNumber = {
                    digit: digit,
                    element: numberElement
                };
                e.dataTransfer.setData('text/plain', digit);
            });
            
            // Случайная позиция в пуле
            const randomPosition = Math.floor(Math.random() * (poolDiv.children.length + 1));
            if (randomPosition === poolDiv.children.length) {
                poolDiv.appendChild(numberElement);
            } else {
                poolDiv.insertBefore(numberElement, poolDiv.children[randomPosition]);
            }
        }
        
        function handleDragStart(event) {
            const slot = event.target;
            
            // Предотвращаем перетаскивание пустых слотов
            if (slot.classList.contains('empty')) {
                event.preventDefault();
                return;
            }
            
            const digit = slot.getAttribute('data-digit');
            const type = slot.getAttribute('data-type');
            const position = slot.getAttribute('data-position');
            
            draggedNumber = {
                digit: digit,
                type: type,
                position: position,
                element: slot
            };
            
            event.dataTransfer.setData('text/plain', digit);
        }
        
        function handleDragOver(event) {
            event.preventDefault();
        }
        
        function handleDrop(event) {
            event.preventDefault();
            const targetSlot = event.target;
            
            if (targetSlot.classList.contains('number-slot') && draggedNumber) {
                // Если перетаскиваем из пула
                if (!draggedNumber.type) {
                    const digit = draggedNumber.digit;
                    
                    // Если целевой слот уже занят, убираем старое число в пул
                    if (targetSlot.classList.contains('draggable')) {
                        const oldDigit = targetSlot.getAttribute('data-digit');
                        targetSlot.classList.remove('draggable');
                        targetSlot.classList.add('empty');
                        targetSlot.textContent = '';
                        targetSlot.removeAttribute('data-digit');
                        
                        // Добавляем старое число в пул
                        addNumberToPool(oldDigit);
                    }
                    
                    // Убираем число из пула
                    draggedNumber.element.remove();
                    
                    // Заполняем слот
                    targetSlot.classList.remove('empty');
                    targetSlot.classList.add('draggable');
                    targetSlot.textContent = digit;
                    targetSlot.setAttribute('data-digit', digit);
                    
                    // Добавляем обработчики
                    targetSlot.addEventListener('click', handleSlotClick);
                    targetSlot.addEventListener('dragstart', handleDragStart);
                } 
                // Если перетаскиваем между слотами
                else {
                    const sourceDigit = draggedNumber.digit;
                    const targetDigit = targetSlot.getAttribute('data-digit');
                    
                    // Меняем цифры местами
                    if (targetDigit) {
                        draggedNumber.element.textContent = targetDigit;
                        draggedNumber.element.setAttribute('data-digit', targetDigit);
                    } else {
                        // Если перетаскиваем в пустой слот
                        draggedNumber.element.classList.remove('draggable');
                        draggedNumber.element.classList.add('empty');
                        draggedNumber.element.textContent = '';
                        draggedNumber.element.removeAttribute('data-digit');
                    }
                    
                    targetSlot.textContent = sourceDigit;
                    targetSlot.classList.remove('empty');
                    targetSlot.classList.add('draggable');
                    targetSlot.setAttribute('data-digit', sourceDigit);
                }
                
                draggedNumber = null;
                checkSolution();
            }
        }
        
        function removeRandomNumbers(count) {
            const draggableSlots = document.querySelectorAll('.number-slot.draggable');
            const slotsToRemove = [];
            
            // Если выбрано больше чисел чем есть, убираем все
            const maxToRemove = Math.min(count, draggableSlots.length);
            
            // Выбираем случайные слоты для удаления
            while (slotsToRemove.length < maxToRemove) {
                const randomIndex = Math.floor(Math.random() * draggableSlots.length);
                const slot = draggableSlots[randomIndex];
                if (!slotsToRemove.includes(slot)) {
                    slotsToRemove.push(slot);
                }
            }
            
            // Удаляем выбранные слоты
            slotsToRemove.forEach(slot => {
                const digit = slot.getAttribute('data-digit');
                slot.classList.remove('draggable');
                slot.classList.add('empty');
                slot.textContent = '';
                slot.removeAttribute('data-digit');
                
                addNumberToPool(digit);
            });
            
            checkSolution();
        }
        
        function checkSolution() {
            if (!currentExample) return;
            
            const { firstNumber, secondNumber, operation, result } = currentExample;
            
            // Собираем текущие значения из слотов
            let currentFirst = '';
            let currentSecond = '';
            let currentResult = '';
            
            const firstSlots = document.querySelectorAll('.number-slot[data-type="first"]');
            const secondSlots = document.querySelectorAll('.number-slot[data-type="second"]');
            const resultSlots = document.querySelectorAll('.number-slot[data-type="result"]');
            
            firstSlots.forEach(slot => {
                currentFirst += slot.getAttribute('data-digit') || '';
            });
            
            secondSlots.forEach(slot => {
                currentSecond += slot.getAttribute('data-digit') || '';
            });
            
            resultSlots.forEach(slot => {
                currentResult += slot.getAttribute('data-digit') || '';
            });
            
            // Проверяем, все ли слоты заполнены (нет пустых строк)
            const allFilled = currentFirst.length === firstSlots.length && 
                             currentSecond.length === secondSlots.length && 
                             currentResult.length === resultSlots.length &&
                             currentFirst !== '' && 
                             currentSecond !== '' && 
                             currentResult !== '';
            
            if (!allFilled) {
                // Убираем подсветку, если не все заполнено
                document.querySelectorAll('.number-slot').forEach(slot => {
                    slot.classList.remove('correct');
                });
                return;
            }
            
            // Проверяем математическую правильность
            let calculatedResult;
            if (operation === '+') {
                calculatedResult = parseInt(currentFirst) + parseInt(currentSecond);
            } else if (operation === '-') {
                calculatedResult = parseInt(currentFirst) - parseInt(currentSecond);
            } else if (operation === '×') {
                calculatedResult = parseInt(currentFirst) * parseInt(currentSecond);
            }
            
            const isCorrect = calculatedResult === parseInt(currentResult);
            
            // Подсвечиваем слоты только если пример правильный
            document.querySelectorAll('.number-slot').forEach(slot => {
                if (isCorrect) {
                    slot.classList.add('correct');
                } else {
                    slot.classList.remove('correct');
                }
            });
        }
        
        function resetExample() {
            if (currentExample) {
                renderExample();
                document.getElementById('numberPool').innerHTML = '';
                checkSolution();
            }
        }
        
        function showAnswer() {
            if (!currentExample) return;
            
            const { firstNumber, secondNumber, result } = currentExample;
            
            // Очищаем пул
            document.getElementById('numberPool').innerHTML = '';
            
            // Заполняем все пустые слоты правильными цифрами
            const firstSlots = document.querySelectorAll('.number-slot[data-type="first"]');
            const secondSlots = document.querySelectorAll('.number-slot[data-type="second"]');
            const resultSlots = document.querySelectorAll('.number-slot[data-type="result"]');
            
            const firstStr = firstNumber.toString();
            const secondStr = secondNumber.toString();
            const resultStr = result.toString();
            
            // Заполняем первое число
            firstSlots.forEach((slot, index) => {
                if (slot.classList.contains('empty')) {
                    const digit = firstStr[index];
                    slot.classList.remove('empty');
                    slot.classList.add('draggable');
                    slot.textContent = digit;
                    slot.setAttribute('data-digit', digit);
                    
                    // Добавляем обработчики
                    slot.addEventListener('click', handleSlotClick);
                    slot.addEventListener('dragstart', handleDragStart);
                }
            });
            
            // Заполняем второе число
            secondSlots.forEach((slot, index) => {
                if (slot.classList.contains('empty')) {
                    const digit = secondStr[index];
                    slot.classList.remove('empty');
                    slot.classList.add('draggable');
                    slot.textContent = digit;
                    slot.setAttribute('data-digit', digit);
                    
                    // Добавляем обработчики
                    slot.addEventListener('click', handleSlotClick);
                    slot.addEventListener('dragstart', handleDragStart);
                }
            });
            
            // Заполняем результат
            resultSlots.forEach((slot, index) => {
                if (slot.classList.contains('empty')) {
                    const digit = resultStr[index];
                    slot.classList.remove('empty');
                    slot.classList.add('draggable');
                    slot.textContent = digit;
                    slot.setAttribute('data-digit', digit);
                    
                    // Добавляем обработчики
                    slot.addEventListener('click', handleSlotClick);
                    slot.addEventListener('dragstart', handleDragStart);
                }
            });
            
            // Проверяем решение
            checkSolution();
        }
        
        // Генерируем пример при загрузке страницы
        window.onload = function() {
            console.log("Страница загружена, запускаем генерацию примера...");
            generateExample();
        }
        
        // Добавляем отладочную информацию
        function debugLog(message) {
            console.log("[DEBUG] " + message);
        }
        
        // Проверяем, что все функции определены
        console.log("Функции определены:", {
            generateExample: typeof generateExample,
            generateRandomNumber: typeof generateRandomNumber,
            renderExample: typeof renderExample,
            createNumberSlots: typeof createNumberSlots
        });
    </script>
</body>
</html>
