<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тренажёр: Угадай число по совпадающим разрядам</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .control-group {
            margin-bottom: 0;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        select, button {
            padding: 10px 15px;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid #ddd;
            width: 100%;
        }
        
        select {
            background-color: white;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: 600;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .task-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .task-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .condition-info {
            font-size: 16px;
            margin-bottom: 15px;
            color: #7f8c8d;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .given-numbers {
            font-size: 22px;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .input-section {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        #numberInput {
            flex: 1;
            padding: 12px;
            font-size: 18px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 5px;
            outline: none;
        }
        
        #numberInput.correct {
            border-color: #27ae60;
            background-color: #e8f6ef;
        }
        
        #numberInput.incorrect {
            border-color: #e74c3c;
            background-color: #fdedec;
        }
        
        .keyboard {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }
        
        .key {
            padding: 15px;
            text-align: center;
            background-color: #ecf0f1;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 18px;
            transition: background-color 0.2s;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .key:hover {
            background-color: #d5dbdb;
        }
        
        .key.backspace {
            background-color: #f1c40f;
            color: white;
        }
        
        .key.enter {
            background-color: #2ecc71;
            color: white;
        }
        
        .key.zero {
            grid-column: span 4;
        }
        
        .results {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .result-box {
            padding: 15px;
            border-radius: 8px;
            min-height: 150px;
        }
        
        .correct-box {
            background-color: #e8f6ef;
            border: 1px solid #27ae60;
        }
        
        .incorrect-box {
            background-color: #fdedec;
            border: 1px solid #e74c3c;
        }
        
        .result-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .numbers-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .number-badge {
            padding: 8px 12px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 16px;
        }
        
        .correct-badge {
            background-color: #27ae60;
            color: white;
        }
        
        .incorrect-badge {
            background-color: #e74c3c;
            color: white;
        }
        
        .answer-button {
            background-color: #9b59b6;
        }
        
        .answer-button:hover {
            background-color: #8e44ad;
        }
        
        .hint {
            font-style: italic;
            color: #7f8c8d;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .match-control {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .match-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .match-option input {
            width: auto;
        }
        
        .match-option label {
            margin-bottom: 0;
            font-weight: normal;
        }
        
        @media (max-width: 768px) {
            .controls {
                grid-template-columns: 1fr;
            }
            
            .results {
                grid-template-columns: 1fr;
            }
            
            .keyboard {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .key.backspace, .key.enter {
                grid-column: span 1;
            }
        }
    </style>
</head>
<body>
    <h1>Тренажёр: Угадай число по совпадающим разрядам</h1>
    
    <div class="controls">
        <div class="control-group">
            <label for="digitCount">Количество разрядов:</label>
            <select id="digitCount">
                <option value="2">Двухзначные числа</option>
                <option value="3">Трехзначные числа</option>
                <option value="4">Четырехзначные числа</option>
            </select>
        </div>
        
        <div class="control-group">
            <label for="matchCount">Сколько разрядов совпадает:</label>
            <div id="matchOptions" class="match-control">
                <!-- Динамически заполнится -->
            </div>
        </div>
        
        <div class="control-group">
            <label for="numberCount">Количество чисел для сравнения:</label>
            <select id="numberCount">
                <!-- Будет заполнено динамически -->
            </select>
        </div>
        
        <div class="control-group">
            <button id="generateBtn">Сгенерировать новое задание</button>
            <button id="showAnswerBtn" class="answer-button">Показать ответ</button>
        </div>
    </div>
    
    <div class="task-section">
        <div class="task-title">Задание:</div>
        <div id="taskDescription">Задумано <span id="digitType">двухзначное</span> число.</div>
        <div class="condition-info" id="conditionText">Даны числа, с каждым из которых у задуманного числа ровно <span id="matchCountText">1</span> <span id="matchWord">разряд</span> совпадает, остальные разряды не совпадают. Найдите задуманное число.</div>
        
        <div class="given-numbers" id="givenNumbers"></div>
        
        <div class="input-section">
            <input type="text" id="numberInput" placeholder="Введите число" maxlength="4" readonly>
        </div>
        
        <div class="keyboard" id="keyboard">
            <!-- Будет заполнено динамически -->
        </div>
        
        <div class="hint" id="hintText">Нажмите кнопки на клавиатуре, чтобы ввести число, затем нажмите Enter</div>
    </div>
    
    <div class="results">
        <div class="result-box correct-box">
            <div class="result-title">Правильные ответы:</div>
            <div class="numbers-list" id="correctAnswers"></div>
        </div>
        
        <div class="result-box incorrect-box">
            <div class="result-title">Неверные попытки:</div>
            <div class="numbers-list" id="incorrectAnswers"></div>
        </div>
    </div>

    <script>
        // Текущее состояние приложения
        let state = {
            digitCount: 2,
            matchCount: 1, // сколько разрядов должно совпадать
            numberCount: 2,
            givenNumbers: [],
            correctAnswers: [],
            incorrectAnswers: [],
            solutionSet: new Set(),
            minCountMap: {2: 2, 3: 3, 4: 4}
        };
        
        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            initNumberCountSelect();
            initMatchOptions();
            initKeyboard();
            generateTask();
            
            // Обработчики событий
            document.getElementById('digitCount').addEventListener('change', function() {
                state.digitCount = parseInt(this.value);
                state.matchCount = 1; // Сбрасываем количество совпадающих разрядов до 1
                updateDigitType();
                initNumberCountSelect();
                initMatchOptions();
                generateTask();
            });
            
            document.getElementById('numberCount').addEventListener('change', function() {
                state.numberCount = parseInt(this.value);
                generateTask();
            });
            
            document.getElementById('generateBtn').addEventListener('click', generateTask);
            document.getElementById('showAnswerBtn').addEventListener('click', showAnswer);
            
            document.getElementById('numberInput').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    checkAnswer();
                } else if (e.key === 'Backspace') {
                    backspace();
                } else if (/^\d$/.test(e.key)) {
                    // Разрешаем ввод только цифр
                    if (this.value.length < state.digitCount) {
                        this.value += e.key;
                    }
                }
            });
        });
        
        // Функция для определения правильной формы слова "разряд"
        function updateMatchWord() {
            const matchWordEl = document.getElementById('matchWord');
            const count = state.matchCount;
            
            // Правила для русского языка:
            // 1, 21, 31... - разряд
            // 2-4, 22-24, 32-34... - разряда
            // 5-20, 25-30, 35-40... - разрядов
            const lastDigit = count % 10;
            const lastTwoDigits = count % 100;
            
            if (lastTwoDigits >= 11 && lastTwoDigits <= 14) {
                // Исключение для 11-14
                matchWordEl.textContent = 'разрядов';
            } else if (lastDigit === 1) {
                matchWordEl.textContent = 'разряд';
            } else if (lastDigit >= 2 && lastDigit <= 4) {
                matchWordEl.textContent = 'разряда';
            } else {
                matchWordEl.textContent = 'разрядов';
            }
        }
        
        // Инициализация опций выбора количества совпадений
        function initMatchOptions() {
            const container = document.getElementById('matchOptions');
            container.innerHTML = '';
            
            // Для 2-значных: только 1 совпадение
            // Для 3-значных: 1 или 2 совпадения
            // Для 4-значных: 1, 2 или 3 совпадения
            const maxMatches = state.digitCount - 1;
            
            for (let i = 1; i <= maxMatches; i++) {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'match-option';
                
                const input = document.createElement('input');
                input.type = 'radio';
                input.name = 'matchCount';
                input.id = `match${i}`;
                input.value = i;
                input.checked = (i === state.matchCount);
                
                input.addEventListener('change', function() {
                    state.matchCount = parseInt(this.value);
                    document.getElementById('matchCountText').textContent = this.value;
                    updateMatchWord();
                    generateTask();
                });
                
                const label = document.createElement('label');
                label.htmlFor = `match${i}`;
                label.textContent = `${i}`;
                
                optionDiv.appendChild(input);
                optionDiv.appendChild(label);
                container.appendChild(optionDiv);
            }
            
            // Обновляем текст условия
            document.getElementById('matchCountText').textContent = state.matchCount;
            updateMatchWord();
        }
        
        // Инициализация выбора количества чисел
        function initNumberCountSelect() {
            const select = document.getElementById('numberCount');
            const minCount = state.minCountMap[state.digitCount];
            
            // Очищаем опции
            select.innerHTML = '';
            
            // Добавляем опции от минимального до 10
            for (let i = minCount; i <= 10; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                if (i === Math.max(minCount, 3)) { // По умолчанию 3 или минимальное, если больше
                    option.selected = true;
                    state.numberCount = i;
                }
                select.appendChild(option);
            }
        }
        
        // Обновление текста о количестве разрядов
        function updateDigitType() {
            const types = {2: "двухзначное", 3: "трехзначное", 4: "четырехзначное"};
            document.getElementById('digitType').textContent = types[state.digitCount];
        }
        
        // Инициализация клавиатуры
        function initKeyboard() {
            const keyboard = document.getElementById('keyboard');
            keyboard.innerHTML = '';
            
            // Первая строка: 1, 2, 3, Backspace
            for (let i = 1; i <= 3; i++) {
                const key = document.createElement('div');
                key.className = 'key';
                key.textContent = i;
                key.addEventListener('click', () => addDigit(i));
                keyboard.appendChild(key);
            }
            
            // Backspace (4-я кнопка в первой строке)
            const backspaceKey = document.createElement('div');
            backspaceKey.className = 'key backspace';
            backspaceKey.textContent = '⌫';
            backspaceKey.addEventListener('click', backspace);
            keyboard.appendChild(backspaceKey);
            
            // Вторая строка: 4, 5, 6, Enter
            for (let i = 4; i <= 6; i++) {
                const key = document.createElement('div');
                key.className = 'key';
                key.textContent = i;
                key.addEventListener('click', () => addDigit(i));
                keyboard.appendChild(key);
            }
            
            // Enter (4-я кнопка во второй строке)
            const enterKey = document.createElement('div');
            enterKey.className = 'key enter';
            enterKey.textContent = '✓ Ввести';
            enterKey.addEventListener('click', checkAnswer);
            keyboard.appendChild(enterKey);
            
            // Третья строка: 7, 8, 9, пустая (скрытая)
            for (let i = 7; i <= 9; i++) {
                const key = document.createElement('div');
                key.className = 'key';
                key.textContent = i;
                key.addEventListener('click', () => addDigit(i));
                keyboard.appendChild(key);
            }
            
            // Пустая ячейка для выравнивания (третья строка, 4-я кнопка)
            const emptyKey = document.createElement('div');
            emptyKey.className = 'key';
            emptyKey.style.visibility = 'hidden';
            keyboard.appendChild(emptyKey);
            
            // Четвертая строка: 0 (занимает всю строку - 4 колонки)
            const zeroKey = document.createElement('div');
            zeroKey.className = 'key zero';
            zeroKey.textContent = '0';
            zeroKey.addEventListener('click', () => addDigit(0));
            keyboard.appendChild(zeroKey);
        }
        
        // Добавление цифры в поле ввода
        function addDigit(digit) {
            const input = document.getElementById('numberInput');
            if (input.value.length < state.digitCount) {
                input.value += digit;
                input.classList.remove('correct', 'incorrect');
            }
        }
        
        // Удаление последней цифры
        function backspace() {
            const input = document.getElementById('numberInput');
            input.value = input.value.slice(0, -1);
            input.classList.remove('correct', 'incorrect');
        }
        
        // Генерация нового задания
        function generateTask() {
            state.givenNumbers = [];
            state.correctAnswers = [];
            state.incorrectAnswers = [];
            state.solutionSet = new Set();
            
            // Очищаем отображение
            document.getElementById('numberInput').value = '';
            document.getElementById('numberInput').classList.remove('correct', 'incorrect');
            document.getElementById('correctAnswers').innerHTML = '';
            document.getElementById('incorrectAnswers').innerHTML = '';
            
            // Генерируем случайное решение
            const solution = generateRandomNumber(state.digitCount);
            
            // Генерируем заданные числа
            generateGivenNumbers(solution);
            
            // Находим все возможные решения
            findAllSolutions();
            
            // Отображаем заданные числа
            displayGivenNumbers();
        }
        
        // Генерация случайного числа с заданным количеством цифр
        function generateRandomNumber(digitCount) {
            let min = Math.pow(10, digitCount - 1);
            let max = Math.pow(10, digitCount) - 1;
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        
        // Генерация заданных чисел на основе решения
        function generateGivenNumbers(solution) {
            const solutionStr = solution.toString().padStart(state.digitCount, '0');
            const usedVariants = new Set();
            
            for (let i = 0; i < state.numberCount; i++) {
                let newNumber;
                let attempts = 0;
                
                do {
                    // Генерируем число с нужным количеством совпадений
                    newNumber = generateNumberWithMatches(solutionStr, state.matchCount);
                    attempts++;
                } while ((usedVariants.has(newNumber) || 
                         newNumber.toString().length !== state.digitCount ||
                         parseInt(newNumber) < Math.pow(10, state.digitCount - 1)) && 
                         attempts < 100);
                
                if (attempts >= 100) {
                    // Если не удалось сгенерировать уникальное, просто используем то, что получилось
                    newNumber = generateNumberWithMatches(solutionStr, state.matchCount);
                }
                
                usedVariants.add(newNumber);
                state.givenNumbers.push(parseInt(newNumber));
            }
        }
        
        // Генерация числа с заданным количеством совпадающих разрядов
        function generateNumberWithMatches(solutionStr, matchesCount) {
            const digitCount = solutionStr.length;
            const nonMatchesCount = digitCount - matchesCount;
            
            // Выбираем позиции, которые будут отличаться
            const positions = Array.from({length: digitCount}, (_, i) => i);
            shuffleArray(positions);
            const diffPositions = positions.slice(0, nonMatchesCount);
            
            // Создаем новое число
            let newDigits = solutionStr.split('').map(d => parseInt(d));
            
            for (const pos of diffPositions) {
                let newDigit;
                do {
                    newDigit = Math.floor(Math.random() * 10);
                } while (newDigit === newDigits[pos]);
                newDigits[pos] = newDigit;
            }
            
            // Проверяем, чтобы первая цифра не была 0 для многозначного числа
            if (newDigits[0] === 0 && digitCount > 1) {
                newDigits[0] = Math.floor(Math.random() * 9) + 1;
            }
            
            return parseInt(newDigits.join(''));
        }
        
        // Перемешивание массива
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // Поиск всех решений
        function findAllSolutions() {
            const min = Math.pow(10, state.digitCount - 1);
            const max = Math.pow(10, state.digitCount) - 1;
            
            for (let n = min; n <= max; n++) {
                if (isValidSolution(n)) {
                    state.solutionSet.add(n);
                }
            }
            
            // Если решений не найдено, генерируем заново
            if (state.solutionSet.size === 0) {
                generateTask();
                return;
            }
        }
        
        // Проверка, является ли число решением
        function isValidSolution(number) {
            const numStr = number.toString().padStart(state.digitCount, '0');
            
            for (const given of state.givenNumbers) {
                const givenStr = given.toString().padStart(state.digitCount, '0');
                let matches = 0;
                
                for (let i = 0; i < state.digitCount; i++) {
                    if (numStr[i] === givenStr[i]) {
                        matches++;
                    }
                }
                
                if (matches !== state.matchCount) {
                    return false;
                }
            }
            
            return true;
        }
        
        // Отображение заданных чисел
        function displayGivenNumbers() {
            const givenNumbersEl = document.getElementById('givenNumbers');
            givenNumbersEl.textContent = state.givenNumbers.join(', ');
        }
        
        // Проверка ответа пользователя
        function checkAnswer() {
            const input = document.getElementById('numberInput');
            const answer = input.value;
            
            // Проверяем, что введено правильное количество цифр
            if (answer.length !== state.digitCount) {
                alert(`Введите ${state.digitCount}-значное число`);
                return;
            }
            
            const numAnswer = parseInt(answer);
            
            if (state.solutionSet.has(numAnswer)) {
                // Правильный ответ
                if (!state.correctAnswers.includes(numAnswer)) {
                    state.correctAnswers.push(numAnswer);
                    input.classList.add('correct');
                    updateResultsDisplay();
                    
                    // Если найдены все решения
                    if (state.correctAnswers.length === state.solutionSet.size) {
                        setTimeout(() => {
                            alert(`Поздравляем! Вы нашли все возможные решения (${state.solutionSet.size} шт.)`);
                        }, 300);
                    }
                }
            } else {
                // Неправильный ответ
                if (!state.incorrectAnswers.includes(numAnswer)) {
                    state.incorrectAnswers.push(numAnswer);
                    input.classList.add('incorrect');
                    updateResultsDisplay();
                }
            }
            
            // Очищаем поле ввода
            setTimeout(() => {
                input.value = '';
                input.classList.remove('correct', 'incorrect');
            }, 500);
        }
        
        // Обновление отображения результатов
        function updateResultsDisplay() {
            const correctEl = document.getElementById('correctAnswers');
            const incorrectEl = document.getElementById('incorrectAnswers');
            
            correctEl.innerHTML = '';
            incorrectEl.innerHTML = '';
            
            state.correctAnswers.forEach(num => {
                const badge = document.createElement('div');
                badge.className = 'number-badge correct-badge';
                badge.textContent = num;
                correctEl.appendChild(badge);
            });
            
            state.incorrectAnswers.forEach(num => {
                const badge = document.createElement('div');
                badge.className = 'number-badge incorrect-badge';
                badge.textContent = num;
                incorrectEl.appendChild(badge);
            });
        }
        
        // Показать ответ
        function showAnswer() {
            if (state.solutionSet.size > 0) {
                const solutions = Array.from(state.solutionSet);
                alert(`Возможные решения: ${solutions.join(', ')}\n\nВсего найдено: ${solutions.length} решение(ий)`);
                
                // Добавляем решения в правильные ответы
                solutions.forEach(solution => {
                    if (!state.correctAnswers.includes(solution)) {
                        state.correctAnswers.push(solution);
                    }
                });
                updateResultsDisplay();
            } else {
                alert('Решения не найдены. Попробуйте сгенерировать новое задание.');
            }
        }
    </script>
</body>
</html>
