<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Математика со смайликами</title>
    <style>
		 /* Шапка с логотипом */
        .header
			{
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

		{
            width: 100%;
            padding: 20px 0;
            background-color: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(5px);
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 10;
            position: relative;
        }

        .logo-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
        }

        .logo-img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 10px;
            transition: transform 0.3s ease;
        }

        .logo-img:hover {
            transform: scale(1.05);
        }

        .logo-title {
            font-size: 1.8em;
            font-weight: bold;
            margin: 5px 0;
            color: white;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }

        .logo-subtitle {
            font-size: 1em;
            opacity: 0.8;
            margin: 0;
            color: black;
        }

        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            background-color: #f5f5f5;
        }
		body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
            linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.1)), /* Затемнение */
            url('f1.jpg') center/cover no-repeat; /* Фоновое изображение */
        z-index: -2;
    }

    /* Поверх фонового изображения добавим ваш градиент с прозрачностью */
    body::after {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(110, 142, 251, 0.8), rgba(167, 119, 227, 0.3));
        z-index: -1;
    }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .game-area {
            background-color: rgba(222, 158, 255, 0.9); /* Увеличим непрозрачность */
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.3); /* Более четкая граница */
    text-align: center;
    position: relative; /* Для псевдоэлемента */
    overflow: hidden; /* Чтобы blur не выходил за границы */
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .mode-selection {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        .mode-btn {
            background: linear-gradient(to right, #00c6ff, #0072ff);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 198, 255, 0.3);
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .play-btn:hover {
        opacity: 0.3;
        transform: scale(0.7);
        filter: grayscale(80%);
    }

        .settings {
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 15px;
    padding: 20px;
    margin: 0 auto 20px; /* Центрирование */
    width: fit-content; /* Ширина по содержимому */
    max-width: 100%; /* Не шире контейнера */
}

.settings-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    width: 100%; /* Фиксированная ширина строк */
    min-width: 350px; /* Минимальная ширина */
}

.settings-row label {
    font-weight: bold;
    margin-right: 15px;
    color: white;
    min-width: 180px; /* Фиксированная ширина лейблов */
    text-align: right; /* Выравнивание текста по правому краю */
}

.settings-row input, 
.settings-row select {
    padding: 10px 15px;
    border-radius: 50px; /* Закругленные углы */
    border: none;
    background-color: rgba(255, 255, 255, 0.9);
    font-size: 16px;
    width: 120px; /* Фиксированная ширина полей ввода */
    box-sizing: border-box; /* Учитываем padding в ширине */    
}
		/* Для мобильных устройств */
@media (max-width: 600px) {
    .settings {
        width: 100%;
        padding: 15px;
    }
    
    .settings-row {
        flex-direction: column;
        align-items: flex-start;
        min-width: unset;
    }
    
    .settings-row label {
        text-align: left;
        margin-bottom: 5px;
        min-width: unset;
        width: 100%;
    }
    
    .settings-row input,
    .settings-row select {
        width: 100%;
    }
}
        .equation {
            font-size: 2.5em;
            margin: 30px 0;
            min-height: 60px;
        }
        .numbers-grid {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 30px 0;
        }
        .number-box {
            width: 80px;
            height: 80px;
            border: 3px solid #3498db;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            background-color: white;
        }
        .number-box:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .number-box.selected {
            background-color: #e8f5e9;
            border-color: #4CAF50;
            color: #2e7d32;
        }
        .controls {
            margin: 20px 0;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .action-btn {
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .check-btn {
            background-color: #f57c00;
        }
        .check-btn:hover {
            background-color: #E37607;
        }
        .check-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .new-game-btn {
            background: linear-gradient(to right, #00c6ff, #0072ff);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 198, 255, 0.3);
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }		
           
        .new-game-btn:hover {
            background-color: #2980b9;
			
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .back-btn {
            background-color: #AF26FF;
        }
        .back-btn:hover {
            background-color: #8C1BCD;
        }
        .message {
            font-size: 1.5em;
            margin: 20px 0;
            min-height: 40px;
            padding: 15px;
            border-radius: 8px;
        }
        .success {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 2px solid #4CAF50;
        }
        .failure {
            background-color: #ffebee;
            color: #c62828;
            border: 2px solid #ef5350;
        }
        .history {
            margin-top: 40px;
            text-align: left;
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
        }
        .history h3 {
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            margin-top: 0;
        }
        .attempt-history {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background-color: white;
        }
        .attempt-number {
            font-weight: bold;
            margin-right: 15px;
            min-width: 30px;
        }
        .attempt-numbers {
            display: flex;
            gap: 10px;
            margin-right: 20px;
            flex-wrap: wrap;
        }
        .attempt-numbers span {
            font-size: 1.5em;
            padding: 5px 10px;
            border-radius: 5px;
            background-color: #f0f0f0;
        }
        .attempt-result {
            margin-left: auto;
            color: #2c3e50;
            font-weight: bold;
        }
        
        @media (max-width: 600px) {
            .settings-row label {
                min-width: 100%;
                margin-bottom: 8px;
            }
            .number-box {
                width: 60px;
                height: 60px;
                font-size: 1.8em;
            }
            .equation {
                font-size: 2em;
            }
            .controls {
                flex-direction: column;
                gap: 10px;
            }
            .action-btn {
                width: 100%;
            }
        }
		/* Стиль для кнопки "Назад" */
         .back-button {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            font-size: 24px;
            border-radius: 50%;
            text-decoration: none;
            margin: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border: none;
        }

        .back-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
		
		
    </style>
</head>
<body>
	<div class="decorations" id="decorations"></div>
    <div class="game-area">
		<!-- Обновленная шапка с логотипом -->    	
        <h1>Математика со смайликами<a href="index.html" class="back-button"> ←</a></h1>
        
        <div id="mode-selection-screen">
            <h2>Выберите тип задания:</h2>
            <div class="mode-selection">
                <button class="mode-btn" data-mode="add2">🌝 + 🙂</button>
                <button class="mode-btn" data-mode="sub2">🌝 - 🙂</button>
                <button class="mode-btn" data-mode="add3">🌝 + 🙂 + 😉</button>
                <button class="mode-btn" data-mode="sub3">🌝 - 🙂 - 😉</button>
                <button class="mode-btn" data-mode="mult_add">🌝 × 🙂 + 😉</button>
                <button class="mode-btn" data-mode="mult_sub">🌝 × 🙂 - 😉</button>
                <button class="mode-btn" data-mode="div_add">🌝 ÷ 🙂 + 😉</button>
                <button class="mode-btn" data-mode="div_sub">🌝 ÷ 🙂 - 😉</button>
            </div>
        </div>
        
        <div id="game-screen" style="display: none;">
            <div class="settings">
                <div class="settings-row">
                    <label for="min-value">Минимальное число:</label>
                    <input type="number" id="min-value" min="1" max="100" value="1">
                </div>
                <div class="settings-row">
                    <label for="max-value">Максимальное число:</label>
                    <input type="number" id="max-value" min="10" max="1000" value="50">
                </div>
                <div class="settings-row">
                    <label for="options-count">Количество вариантов ответа:</label>
                    <select id="options-count">
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5" selected>5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                    </select>
                </div>
            </div>
            
            <button id="back-btn" class="action-btn back-btn">К выбору модели</button>
            
            <div class="equation" id="equation-display"></div>
            
            <div class="numbers-grid" id="numbers-grid"></div>
            
            <div class="controls">
                <button id="check-btn" class="action-btn check-btn" disabled>Проверить</button>
				<button id="new-game-btn" class="action-btn new-game-btn">Новая игра</button>
                
            </div>
            
            <div class="message" id="message"></div>
            
            <div class="history">
                <h3>История попыток:</h3>
                <div id="history-container"></div>
            </div>
        </div>
    </div>

    <script>
        // Банк смайликов
        const EMOJIS = ["🍧", "💎", "👑", "💖", "🎄", "🌸", "🎀", "⭐", "🎃", "🐟", "🎲", "🧩", "⛏️", "🔧", "💊"];
        
        // Переменные игры
        let currentMode = '';
        let correctNumbers = [];
        let selectedNumbers = [];
        let gameHistory = [];
        let usedEmojis = [];

        // Элементы интерфейса
        const modeSelectionScreen = document.getElementById('mode-selection-screen');
        const gameScreen = document.getElementById('game-screen');
        const equationDisplay = document.getElementById('equation-display');
        const numbersGrid = document.getElementById('numbers-grid');
        const checkBtn = document.getElementById('check-btn');
        const newGameBtn = document.getElementById('new-game-btn');
        const backBtn = document.getElementById('back-btn');
        const messageDiv = document.getElementById('message');
        const historyContainer = document.getElementById('history-container');
        const minValueInput = document.getElementById('min-value');
        const maxValueInput = document.getElementById('max-value');
        const optionsCountSelect = document.getElementById('options-count');
        let numberBoxes = []; // Массив для хранения всех number-box элементов

        // Обработчики событий
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                currentMode = this.getAttribute('data-mode');
                startGame();
            });
        });

        newGameBtn.addEventListener('click', startGame);
        backBtn.addEventListener('click', () => {
            gameScreen.style.display = 'none';
            modeSelectionScreen.style.display = 'block';
        });

        checkBtn.addEventListener('click', checkAnswer);

        // Функция начала игры
        function startGame() {
            modeSelectionScreen.style.display = 'none';
            gameScreen.style.display = 'block';

            const minValue = parseInt(minValueInput.value);
            const maxValue = parseInt(maxValueInput.value);
            const optionsCount = parseInt(optionsCountSelect.value);

            // Проверка корректности введенных значений
            if (minValue >= maxValue) {
                alert('Минимальное значение должно быть меньше максимального!');
                return;
            }
            if (minValue < 1) {
                alert('Минимальное значение должно быть не меньше 1!');
                return;
            }

            // Генерация случайных чисел
            correctNumbers = generateNumbers(currentMode, minValue, maxValue);
            const allNumbers = generateOptions(correctNumbers, optionsCount, minValue, maxValue, currentMode);

            // Выбор случайных смайликов
            usedEmojis = [];
            const shuffledEmojis = [...EMOJIS].sort(() => Math.random() - 0.5);

            // Отображение уравнения
            displayEquation(currentMode, correctNumbers, shuffledEmojis);

            // Отображение вариантов ответа
            displayNumberOptions(allNumbers);

            // Сброс выбора
            selectedNumbers = [];
            checkBtn.disabled = true;
            messageDiv.textContent = '';
            messageDiv.className = 'message';
        }

        // Генерация чисел для уравнения в зависимости от режима
        function generateNumbers(mode, min, max) {
            let a, b, c;

            switch(mode) {
                case 'add2':
                    a = getRandomInt(min, Math.floor(max / 2));
                    b = getRandomInt(min, max - a);
                    return [a, b, a + b];

                case 'sub2':
                    b = getRandomInt(min, Math.floor(max / 2));
                    a = getRandomInt(b + min, max);
                    return [a, b, a - b];

                case 'add3':
                    a = getRandomInt(min, Math.floor(max / 3));
                    b = getRandomInt(min, Math.floor((max - a) / 2));
                    c = getRandomInt(min, max - a - b);
                    return [a, b, c, a + b + c];

                case 'sub3':
                    b = getRandomInt(min, Math.floor(max / 3));
                    c = getRandomInt(min, Math.floor((max - b) / 2));
                    a = getRandomInt(b + c + min, max);
                    return [a, b, c, a - b - c];

                case 'mult_add':
                    a = getRandomInt(1, Math.floor(Math.sqrt(max)));
                    b = getRandomInt(1, Math.floor((max - min) / a));
                    c = getRandomInt(min, max - a * b);
                    return [a, b, c, a * b + c];

                case 'mult_sub':
                    a = getRandomInt(1, Math.floor(Math.sqrt(max)));
                    b = getRandomInt(1, Math.floor((max - min) / a));
                    c = getRandomInt(min, a * b - min);
                    return [a, b, c, a * b - c];

                case 'div_add':
                    b = getRandomInt(2, Math.floor(Math.sqrt(max)));
                    a = b * getRandomInt(1, Math.floor((max - min) / b));
                    c = getRandomInt(min, max - a / b);
                    return [a, b, c, a / b + c];

                case 'div_sub':
                    b = getRandomInt(2, Math.floor(Math.sqrt(max)));
                    a = b * getRandomInt(2, Math.floor((max + min) / b));
                    c = getRandomInt(min, a / b - min);
                    return [a, b, c, a / b - c];

                default:
                    return [];
            }
        }

        // Генерация вариантов ответа (правильные + случайные)
        function generateOptions(correctNumbers, count, min, max, mode) {
            const correctOptions = correctNumbers.slice(0, -1);
            let options = [...correctOptions];

            // Узнаем результат (последнее число)
            const result = correctNumbers[correctNumbers.length - 1];

            while (options.length < count) {
                let randomNum;

                // Для режимов сложения ограничиваем случайные числа суммой
                if (mode === 'add2' || mode === 'add3') {
                    randomNum = getRandomInt(min, result); // Случайное число до суммы
                } else {
                    randomNum = getRandomInt(min, max);  // В остальных режимах без ограничений
                }

                options.push(randomNum);

            }

            // Перемешиваем массив
            return shuffleArray(options);
        }

        // Отображение уравнения
        function displayEquation(mode, numbers, emojis) {
            let equation = '';
            usedEmojis = [];

            switch(mode) {
                case 'add2':
                    equation = `${emojis[0]} + ${emojis[1]} = ${numbers[2]}`;
                    usedEmojis = [emojis[0], emojis[1]];
                    break;

                case 'sub2':
                    equation = `${emojis[0]} - ${emojis[1]} = ${numbers[2]}`;
                    usedEmojis = [emojis[0], emojis[1]];
                    break;

                case 'add3':
                    equation = `${emojis[0]} + ${emojis[1]} + ${emojis[2]} = ${numbers[3]}`;
                    usedEmojis = [emojis[0], emojis[1], emojis[2]];
                    break;

                case 'sub3':
                    equation = `${emojis[0]} - ${emojis[1]} - ${emojis[2]} = ${numbers[3]}`;
                    usedEmojis = [emojis[0], emojis[1], emojis[2]];
                    break;

                case 'mult_add':
                    equation = `${emojis[0]} × ${emojis[1]} + ${emojis[2]} = ${numbers[3]}`;
                    usedEmojis = [emojis[0], emojis[1], emojis[2]];
                    break;

                case 'mult_sub':
                    equation = `${emojis[0]} × ${emojis[1]} - ${emojis[2]} = ${numbers[3]}`;
                    usedEmojis = [emojis[0], emojis[1], emojis[2]];
                    break;

                case 'div_add':
                    equation = `${emojis[0]} ÷ ${emojis[1]} + ${emojis[2]} = ${numbers[3]}`;
                    usedEmojis = [emojis[0], emojis[1], emojis[2]];
                    break;

                case 'div_sub':
                    equation = `${emojis[0]} ÷ ${emojis[1]} - ${emojis[2]} = ${numbers[3]}`;
                    usedEmojis = [emojis[0], emojis[1], emojis[2]];
                    break;
            }

            equationDisplay.textContent = equation;
        }

        // Отображение вариантов ответа
         function displayNumberOptions(numbers) {
            numbersGrid.innerHTML = '';
            numberBoxes = []; // Очищаем массив перед каждым новым набором

            numbers.forEach(num => {
                const numberBox = document.createElement('div');
                numberBox.className = 'number-box';
                numberBox.textContent = num;
                numberBox.dataset.number = num; // Добавляем число в data атрибут
                numberBox.addEventListener('click', () => toggleNumberSelection(num, numberBox));
                numbersGrid.appendChild(numberBox);
                numberBoxes.push(numberBox); // Добавляем элемент в массив
            });
        }
        // Выбор/снятие выбора числа
        function toggleNumberSelection(num, element) {
            const numberBoxesWithNumber = numberBoxes.filter(box => box.dataset.number == num);
            const isSelected = element.classList.contains('selected');

            if (!isSelected) {
                selectedNumbers.push(num);
                element.classList.add('selected');
            } else {
                let index = selectedNumbers.indexOf(num);
                if (index > -1) {
                    selectedNumbers.splice(index, 1);
                    element.classList.remove('selected');
                }
            }
            checkBtn.disabled = selectedNumbers.length === 0;
        }

        // Проверка ответа
        function checkAnswer() {
            // Определяем, какие числа должны быть выбраны (все кроме последнего - это результат)
            const correctOptions = correctNumbers.slice(0, -1);
            const selectedCopy = [...selectedNumbers].sort((a, b) => a - b);
            const correctCopy = [...correctOptions].sort((a, b) => a - b);

            let isCorrect = selectedCopy.length === correctCopy.length;

            if (isCorrect) {
                const selectedCounts = {};
                const correctCounts = {};

                // Считаем количество каждого числа в массиве выбранных чисел
                selectedNumbers.forEach(num => {
                    selectedCounts[num] = (selectedCounts[num] || 0) + 1;
                });

                // Считаем количество каждого числа в массиве правильных чисел
                correctOptions.forEach(num => {
                    correctCounts[num] = (correctCounts[num] || 0) + 1;
                });

                // Сравниваем числа и их количество между selectedCounts и correctCounts
                for (let i = 0; i < selectedCopy.length; i++) {
                    const num = selectedCopy[i];
                    if (!correctCounts[num] || selectedCounts[num] !== correctCounts[num]) {
                        isCorrect = false;
                        break;
                    }
                }
            }

            // Добавляем попытку в историю
            addToHistory(selectedNumbers, isCorrect);

            // Показываем результат
            if (isCorrect) {
                showMessage('Поздравляем! Вы правильно выбрали числа!', 'success');
            } else {
                showMessage('Попробуйте еще раз!', 'failure');
            }
        }

        // Добавление попытки в историю
        function addToHistory(numbers, isCorrect) {
            const attemptDiv = document.createElement('div');
            attemptDiv.className = 'attempt-history';

            // Отображаем все выбранные числа, включая дубликаты
            const numbersHTML = numbers.map(num => `<span>${num}</span>`).join('');

            attemptDiv.innerHTML = `
                <div class="attempt-number">${gameHistory.length + 1}</div>
                <div class="attempt-numbers">${numbersHTML}</div>
                <div class="attempt-result">${isCorrect ? '✓ Верно' : '✗ Неверно'}</div>
            `;

            historyContainer.prepend(attemptDiv);
            gameHistory.unshift({numbers: [...numbers], correct: isCorrect});
        }
        
        // Показать сообщение
        function showMessage(text, type) {
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
        }
        
        // Вспомогательная функция для получения случайного целого числа
        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        
        // Функция для перемешивания массива
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
    </script>
</body>
</html>