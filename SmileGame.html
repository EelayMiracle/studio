<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ —Å–æ —Å–º–∞–π–ª–∏–∫–∞–º–∏</title>
    <style>
		 /* –®–∞–ø–∫–∞ —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º */
        .header
			{
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

		{
            width: 100%;
            padding: 20px 0;
            background-color: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(5px);
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 10;
            position: relative;
        }

        .logo-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
        }

        .logo-img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 10px;
            transition: transform 0.3s ease;
        }

        .logo-img:hover {
            transform: scale(1.05);
        }

        .logo-title {
            font-size: 1.8em;
            font-weight: bold;
            margin: 5px 0;
            color: white;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }

        .logo-subtitle {
            font-size: 1em;
            opacity: 0.8;
            margin: 0;
            color: black;
        }

        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            background-color: #f5f5f5;
        }
		body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
            linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.1)), /* –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ */
            url('f1.jpg') center/cover no-repeat; /* –§–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ */
        z-index: -2;
    }

    /* –ü–æ–≤–µ—Ä—Ö —Ñ–æ–Ω–æ–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–±–∞–≤–∏–º –≤–∞—à –≥—Ä–∞–¥–∏–µ–Ω—Ç —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é */
    body::after {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(110, 142, 251, 0.8), rgba(167, 119, 227, 0.3));
        z-index: -1;
    }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .game-area {
            background-color: rgba(222, 158, 255, 0.9); /* –£–≤–µ–ª–∏—á–∏–º –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å */
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.3); /* –ë–æ–ª–µ–µ —á–µ—Ç–∫–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ */
    text-align: center;
    position: relative; /* –î–ª—è –ø—Å–µ–≤–¥–æ—ç–ª–µ–º–µ–Ω—Ç–∞ */
    overflow: hidden; /* –ß—Ç–æ–±—ã blur –Ω–µ –≤—ã—Ö–æ–¥–∏–ª –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã */
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .mode-selection {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        .mode-btn {
            background: linear-gradient(to right, #00c6ff, #0072ff);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 198, 255, 0.3);
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .play-btn:hover {
        opacity: 0.3;
        transform: scale(0.7);
        filter: grayscale(80%);
    }

        .settings {
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 15px;
    padding: 20px;
    margin: 0 auto 20px; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ */
    width: fit-content; /* –®–∏—Ä–∏–Ω–∞ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É */
    max-width: 100%; /* –ù–µ —à–∏—Ä–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
}

.settings-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    width: 100%; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ —Å—Ç—Ä–æ–∫ */
    min-width: 350px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
}

.settings-row label {
    font-weight: bold;
    margin-right: 15px;
    color: white;
    min-width: 180px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –ª–µ–π–±–ª–æ–≤ */
    text-align: right; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é */
}

.settings-row input, 
.settings-row select {
    padding: 10px 15px;
    border-radius: 50px; /* –ó–∞–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ —É–≥–ª—ã */
    border: none;
    background-color: rgba(255, 255, 255, 0.9);
    font-size: 16px;
    width: 120px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ */
    box-sizing: border-box; /* –£—á–∏—Ç—ã–≤–∞–µ–º padding –≤ —à–∏—Ä–∏–Ω–µ */    
}
		/* –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
@media (max-width: 600px) {
    .settings {
        width: 100%;
        padding: 15px;
    }
    
    .settings-row {
        flex-direction: column;
        align-items: flex-start;
        min-width: unset;
    }
    
    .settings-row label {
        text-align: left;
        margin-bottom: 5px;
        min-width: unset;
        width: 100%;
    }
    
    .settings-row input,
    .settings-row select {
        width: 100%;
    }
}
        .equation {
            font-size: 2.5em;
            margin: 30px 0;
            min-height: 60px;
        }
        .numbers-grid {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 30px 0;
        }
        .number-box {
            width: 80px;
            height: 80px;
            border: 3px solid #3498db;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            background-color: white;
        }
        .number-box:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .number-box.selected {
            background-color: #e8f5e9;
            border-color: #4CAF50;
            color: #2e7d32;
        }
        .controls {
            margin: 20px 0;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .action-btn {
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .check-btn {
            background-color: #f57c00;
        }
        .check-btn:hover {
            background-color: #E37607;
        }
        .check-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .new-game-btn {
            background: linear-gradient(to right, #00c6ff, #0072ff);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 198, 255, 0.3);
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }		
           
        .new-game-btn:hover {
            background-color: #2980b9;
			
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .back-btn {
            background-color: #AF26FF;
        }
        .back-btn:hover {
            background-color: #8C1BCD;
        }
        .message {
            font-size: 1.5em;
            margin: 20px 0;
            min-height: 40px;
            padding: 15px;
            border-radius: 8px;
        }
        .success {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 2px solid #4CAF50;
        }
        .failure {
            background-color: #ffebee;
            color: #c62828;
            border: 2px solid #ef5350;
        }
        .history {
            margin-top: 40px;
            text-align: left;
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
        }
        .history h3 {
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            margin-top: 0;
        }
        .attempt-history {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background-color: white;
        }
        .attempt-number {
            font-weight: bold;
            margin-right: 15px;
            min-width: 30px;
        }
        .attempt-numbers {
            display: flex;
            gap: 10px;
            margin-right: 20px;
            flex-wrap: wrap;
        }
        .attempt-numbers span {
            font-size: 1.5em;
            padding: 5px 10px;
            border-radius: 5px;
            background-color: #f0f0f0;
        }
        .attempt-result {
            margin-left: auto;
            color: #2c3e50;
            font-weight: bold;
        }
        
        @media (max-width: 600px) {
            .settings-row label {
                min-width: 100%;
                margin-bottom: 8px;
            }
            .number-box {
                width: 60px;
                height: 60px;
                font-size: 1.8em;
            }
            .equation {
                font-size: 2em;
            }
            .controls {
                flex-direction: column;
                gap: 10px;
            }
            .action-btn {
                width: 100%;
            }
        }
		/* –°—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" */
         .back-button {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            font-size: 24px;
            border-radius: 50%;
            text-decoration: none;
            margin: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border: none;
        }

        .back-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
		
		
    </style>
</head>
<body>
	<div class="decorations" id="decorations"></div>
    <div class="game-area">
		<!-- –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —à–∞–ø–∫–∞ —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º -->    	
        <h1>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ —Å–æ —Å–º–∞–π–ª–∏–∫–∞–º–∏<a href="index.html" class="back-button"> ‚Üê</a></h1>
        
        <div id="mode-selection-screen">
            <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∑–∞–¥–∞–Ω–∏—è:</h2>
            <div class="mode-selection">
                <button class="mode-btn" data-mode="add2">üåù + üôÇ</button>
                <button class="mode-btn" data-mode="sub2">üåù - üôÇ</button>
                <button class="mode-btn" data-mode="add3">üåù + üôÇ + üòâ</button>
                <button class="mode-btn" data-mode="sub3">üåù - üôÇ - üòâ</button>
                <button class="mode-btn" data-mode="mult_add">üåù √ó üôÇ + üòâ</button>
                <button class="mode-btn" data-mode="mult_sub">üåù √ó üôÇ - üòâ</button>
                <button class="mode-btn" data-mode="div_add">üåù √∑ üôÇ + üòâ</button>
                <button class="mode-btn" data-mode="div_sub">üåù √∑ üôÇ - üòâ</button>
            </div>
        </div>
        
        <div id="game-screen" style="display: none;">
            <div class="settings">
                <div class="settings-row">
                    <label for="min-value">–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ:</label>
                    <input type="number" id="min-value" min="1" max="100" value="1">
                </div>
                <div class="settings-row">
                    <label for="max-value">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ:</label>
                    <input type="number" id="max-value" min="10" max="1000" value="50">
                </div>
                <div class="settings-row">
                    <label for="options-count">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞:</label>
                    <select id="options-count">
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5" selected>5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                    </select>
                </div>
            </div>
            
            <button id="back-btn" class="action-btn back-btn">–ö –≤—ã–±–æ—Ä—É –º–æ–¥–µ–ª–∏</button>
            
            <div class="equation" id="equation-display"></div>
            
            <div class="numbers-grid" id="numbers-grid"></div>
            
            <div class="controls">
                <button id="check-btn" class="action-btn check-btn" disabled>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
				<button id="new-game-btn" class="action-btn new-game-btn">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
                
            </div>
            
            <div class="message" id="message"></div>
            
            <div class="history">
                <h3>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–ø—ã—Ç–æ–∫:</h3>
                <div id="history-container"></div>
            </div>
        </div>
    </div>

    <script>
        // –ë–∞–Ω–∫ —Å–º–∞–π–ª–∏–∫–æ–≤
        const EMOJIS = ["üçß", "üíé", "üëë", "üíñ", "üéÑ", "üå∏", "üéÄ", "‚≠ê", "üéÉ", "üêü", "üé≤", "üß©", "‚õèÔ∏è", "üîß", "üíä"];
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã
        let currentMode = '';
        let correctNumbers = [];
        let selectedNumbers = [];
        let gameHistory = [];
        let usedEmojis = [];

        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const modeSelectionScreen = document.getElementById('mode-selection-screen');
        const gameScreen = document.getElementById('game-screen');
        const equationDisplay = document.getElementById('equation-display');
        const numbersGrid = document.getElementById('numbers-grid');
        const checkBtn = document.getElementById('check-btn');
        const newGameBtn = document.getElementById('new-game-btn');
        const backBtn = document.getElementById('back-btn');
        const messageDiv = document.getElementById('message');
        const historyContainer = document.getElementById('history-container');
        const minValueInput = document.getElementById('min-value');
        const maxValueInput = document.getElementById('max-value');
        const optionsCountSelect = document.getElementById('options-count');
        let numberBoxes = []; // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö number-box —ç–ª–µ–º–µ–Ω—Ç–æ–≤

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                currentMode = this.getAttribute('data-mode');
                startGame();
            });
        });

        newGameBtn.addEventListener('click', startGame);
        backBtn.addEventListener('click', () => {
            gameScreen.style.display = 'none';
            modeSelectionScreen.style.display = 'block';
        });

        checkBtn.addEventListener('click', checkAnswer);

        // –§—É–Ω–∫—Ü–∏—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã
        function startGame() {
            modeSelectionScreen.style.display = 'none';
            gameScreen.style.display = 'block';

            const minValue = parseInt(minValueInput.value);
            const maxValue = parseInt(maxValueInput.value);
            const optionsCount = parseInt(optionsCountSelect.value);

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
            if (minValue >= maxValue) {
                alert('–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–Ω—å—à–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ!');
                return;
            }
            if (minValue < 1) {
                alert('–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω—å—à–µ 1!');
                return;
            }

            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª
            correctNumbers = generateNumbers(currentMode, minValue, maxValue);
            const allNumbers = generateOptions(correctNumbers, optionsCount, minValue, maxValue, currentMode);

            // –í—ã–±–æ—Ä —Å–ª—É—á–∞–π–Ω—ã—Ö —Å–º–∞–π–ª–∏–∫–æ–≤
            usedEmojis = [];
            const shuffledEmojis = [...EMOJIS].sort(() => Math.random() - 0.5);

            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è
            displayEquation(currentMode, correctNumbers, shuffledEmojis);

            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞
            displayNumberOptions(allNumbers);

            // –°–±—Ä–æ—Å –≤—ã–±–æ—Ä–∞
            selectedNumbers = [];
            checkBtn.disabled = true;
            messageDiv.textContent = '';
            messageDiv.className = 'message';
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–∏—Å–µ–ª –¥–ª—è —É—Ä–∞–≤–Ω–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
        function generateNumbers(mode, min, max) {
            let a, b, c;

            switch(mode) {
                case 'add2':
                    a = getRandomInt(min, Math.floor(max / 2));
                    b = getRandomInt(min, max - a);
                    return [a, b, a + b];

                case 'sub2':
                    b = getRandomInt(min, Math.floor(max / 2));
                    a = getRandomInt(b + min, max);
                    return [a, b, a - b];

                case 'add3':
                    a = getRandomInt(min, Math.floor(max / 3));
                    b = getRandomInt(min, Math.floor((max - a) / 2));
                    c = getRandomInt(min, max - a - b);
                    return [a, b, c, a + b + c];

                case 'sub3':
                    b = getRandomInt(min, Math.floor(max / 3));
                    c = getRandomInt(min, Math.floor((max - b) / 2));
                    a = getRandomInt(b + c + min, max);
                    return [a, b, c, a - b - c];

                case 'mult_add':
                    a = getRandomInt(1, Math.floor(Math.sqrt(max)));
                    b = getRandomInt(1, Math.floor((max - min) / a));
                    c = getRandomInt(min, max - a * b);
                    return [a, b, c, a * b + c];

                case 'mult_sub':
                    a = getRandomInt(1, Math.floor(Math.sqrt(max)));
                    b = getRandomInt(1, Math.floor((max - min) / a));
                    c = getRandomInt(min, a * b - min);
                    return [a, b, c, a * b - c];

                case 'div_add':
                    b = getRandomInt(2, Math.floor(Math.sqrt(max)));
                    a = b * getRandomInt(1, Math.floor((max - min) / b));
                    c = getRandomInt(min, max - a / b);
                    return [a, b, c, a / b + c];

                case 'div_sub':
                    b = getRandomInt(2, Math.floor(Math.sqrt(max)));
                    a = b * getRandomInt(2, Math.floor((max + min) / b));
                    c = getRandomInt(min, a / b - min);
                    return [a, b, c, a / b - c];

                default:
                    return [];
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞ (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ + —Å–ª—É—á–∞–π–Ω—ã–µ)
        function generateOptions(correctNumbers, count, min, max, mode) {
            const correctOptions = correctNumbers.slice(0, -1);
            let options = [...correctOptions];

            // –£–∑–Ω–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–ø–æ—Å–ª–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ)
            const result = correctNumbers[correctNumbers.length - 1];

            while (options.length < count) {
                let randomNum;

                // –î–ª—è —Ä–µ–∂–∏–º–æ–≤ —Å–ª–æ–∂–µ–Ω–∏—è –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ —á–∏—Å–ª–∞ —Å—É–º–º–æ–π
                if (mode === 'add2' || mode === 'add3') {
                    randomNum = getRandomInt(min, result); // –°–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –¥–æ —Å—É–º–º—ã
                } else {
                    randomNum = getRandomInt(min, max);  // –í –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
                }

                options.push(randomNum);

            }

            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –º–∞—Å—Å–∏–≤
            return shuffleArray(options);
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è
        function displayEquation(mode, numbers, emojis) {
            let equation = '';
            usedEmojis = [];

            switch(mode) {
                case 'add2':
                    equation = `${emojis[0]} + ${emojis[1]} = ${numbers[2]}`;
                    usedEmojis = [emojis[0], emojis[1]];
                    break;

                case 'sub2':
                    equation = `${emojis[0]} - ${emojis[1]} = ${numbers[2]}`;
                    usedEmojis = [emojis[0], emojis[1]];
                    break;

                case 'add3':
                    equation = `${emojis[0]} + ${emojis[1]} + ${emojis[2]} = ${numbers[3]}`;
                    usedEmojis = [emojis[0], emojis[1], emojis[2]];
                    break;

                case 'sub3':
                    equation = `${emojis[0]} - ${emojis[1]} - ${emojis[2]} = ${numbers[3]}`;
                    usedEmojis = [emojis[0], emojis[1], emojis[2]];
                    break;

                case 'mult_add':
                    equation = `${emojis[0]} √ó ${emojis[1]} + ${emojis[2]} = ${numbers[3]}`;
                    usedEmojis = [emojis[0], emojis[1], emojis[2]];
                    break;

                case 'mult_sub':
                    equation = `${emojis[0]} √ó ${emojis[1]} - ${emojis[2]} = ${numbers[3]}`;
                    usedEmojis = [emojis[0], emojis[1], emojis[2]];
                    break;

                case 'div_add':
                    equation = `${emojis[0]} √∑ ${emojis[1]} + ${emojis[2]} = ${numbers[3]}`;
                    usedEmojis = [emojis[0], emojis[1], emojis[2]];
                    break;

                case 'div_sub':
                    equation = `${emojis[0]} √∑ ${emojis[1]} - ${emojis[2]} = ${numbers[3]}`;
                    usedEmojis = [emojis[0], emojis[1], emojis[2]];
                    break;
            }

            equationDisplay.textContent = equation;
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞
         function displayNumberOptions(numbers) {
            numbersGrid.innerHTML = '';
            numberBoxes = []; // –û—á–∏—â–∞–µ–º –º–∞—Å—Å–∏–≤ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –Ω–æ–≤—ã–º –Ω–∞–±–æ—Ä–æ–º

            numbers.forEach(num => {
                const numberBox = document.createElement('div');
                numberBox.className = 'number-box';
                numberBox.textContent = num;
                numberBox.dataset.number = num; // –î–æ–±–∞–≤–ª—è–µ–º —á–∏—Å–ª–æ –≤ data –∞—Ç—Ä–∏–±—É—Ç
                numberBox.addEventListener('click', () => toggleNumberSelection(num, numberBox));
                numbersGrid.appendChild(numberBox);
                numberBoxes.push(numberBox); // –î–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –≤ –º–∞—Å—Å–∏–≤
            });
        }
        // –í—ã–±–æ—Ä/—Å–Ω—è—Ç–∏–µ –≤—ã–±–æ—Ä–∞ —á–∏—Å–ª–∞
        function toggleNumberSelection(num, element) {
            const numberBoxesWithNumber = numberBoxes.filter(box => box.dataset.number == num);
            const isSelected = element.classList.contains('selected');

            if (!isSelected) {
                selectedNumbers.push(num);
                element.classList.add('selected');
            } else {
                let index = selectedNumbers.indexOf(num);
                if (index > -1) {
                    selectedNumbers.splice(index, 1);
                    element.classList.remove('selected');
                }
            }
            checkBtn.disabled = selectedNumbers.length === 0;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞
        function checkAnswer() {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫–∏–µ —á–∏—Å–ª–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—ã–±—Ä–∞–Ω—ã (–≤—Å–µ –∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ - —ç—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç)
            const correctOptions = correctNumbers.slice(0, -1);
            const selectedCopy = [...selectedNumbers].sort((a, b) => a - b);
            const correctCopy = [...correctOptions].sort((a, b) => a - b);

            let isCorrect = selectedCopy.length === correctCopy.length;

            if (isCorrect) {
                const selectedCounts = {};
                const correctCounts = {};

                // –°—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–∂–¥–æ–≥–æ —á–∏—Å–ª–∞ –≤ –º–∞—Å—Å–∏–≤–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —á–∏—Å–µ–ª
                selectedNumbers.forEach(num => {
                    selectedCounts[num] = (selectedCounts[num] || 0) + 1;
                });

                // –°—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–∂–¥–æ–≥–æ —á–∏—Å–ª–∞ –≤ –º–∞—Å—Å–∏–≤–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª
                correctOptions.forEach(num => {
                    correctCounts[num] = (correctCounts[num] || 0) + 1;
                });

                // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —á–∏—Å–ª–∞ –∏ –∏—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ–∂–¥—É selectedCounts –∏ correctCounts
                for (let i = 0; i < selectedCopy.length; i++) {
                    const num = selectedCopy[i];
                    if (!correctCounts[num] || selectedCounts[num] !== correctCounts[num]) {
                        isCorrect = false;
                        break;
                    }
                }
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ø—ã—Ç–∫—É –≤ –∏—Å—Ç–æ—Ä–∏—é
            addToHistory(selectedNumbers, isCorrect);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            if (isCorrect) {
                showMessage('–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–±—Ä–∞–ª–∏ —á–∏—Å–ª–∞!', 'success');
            } else {
                showMessage('–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑!', 'failure');
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ø—ã—Ç–∫–∏ –≤ –∏—Å—Ç–æ—Ä–∏—é
        function addToHistory(numbers, isCorrect) {
            const attemptDiv = document.createElement('div');
            attemptDiv.className = 'attempt-history';

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —á–∏—Å–ª–∞, –≤–∫–ª—é—á–∞—è –¥—É–±–ª–∏–∫–∞—Ç—ã
            const numbersHTML = numbers.map(num => `<span>${num}</span>`).join('');

            attemptDiv.innerHTML = `
                <div class="attempt-number">${gameHistory.length + 1}</div>
                <div class="attempt-numbers">${numbersHTML}</div>
                <div class="attempt-result">${isCorrect ? '‚úì –í–µ—Ä–Ω–æ' : '‚úó –ù–µ–≤–µ—Ä–Ω–æ'}</div>
            `;

            historyContainer.prepend(attemptDiv);
            gameHistory.unshift({numbers: [...numbers], correct: isCorrect});
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(text, type) {
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞
        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è –º–∞—Å—Å–∏–≤–∞
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
    </script>
</body>
</html>