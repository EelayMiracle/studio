<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—Ä–µ–Ω–∞–∂–µ—Ä –µ–¥–∏–Ω–∏—Ü –¥–ª–∏–Ω—ã (–Ω–∞ –æ—Å–Ω–æ–≤–µ SVG)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
 body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.1)),
                url('img/f1.jpg') center/cover no-repeat;
            z-index: -2;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(110, 142, 251, 0.8), rgba(167, 119, 227, 0.3));
            z-index: -1;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            min-height: 600px;
        }

        .settings-panel {
            width: 300px;
            background: #f8f9fa;
            padding: 30px;
            border-right: 1px solid #e9ecef;
        }

        .settings-panel h3 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .setting-group {
            margin-bottom: 25px;
        }

        .setting-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #495057;
        }

        .setting-group input, .setting-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .setting-group input:focus, .setting-group select:focus {
            outline: none;
            border-color: #4facfe;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
        }

        .unit-ranges {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .unit-range {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }

        .unit-range label {
            font-size: 0.9em;
            margin-bottom: 0;
            min-width: 120px;
        }

        .unit-range input[type="number"] {
            width: 50px;
            padding: 4px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            text-align: center;
        }

        .game-area {
            flex: 1;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .task-display {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            width: 100%;
            text-align: center;
        }

        .task-question {
            font-size: 1.4em;
            color: #495057;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .diagram-container {
            position: relative;
            height: 400px;
            margin: 30px 0;
            background: #fff;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            overflow: hidden;
        }

        .diagram-svg {
            width: 100%;
            height: 100%;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
        .diagram-svg circle, .diagram-svg line, .diagram-svg text {
            transition: all 0.5s ease-in-out;
        }

        .questions-container {
            width: 100%;
            margin: 20px 0;
        }

        .question-block {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid #e9ecef;
        }

        .question-block h4 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .answers-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            width: 100%;
        }

        .answer-option {
            background: white;
            border: 3px solid #e9ecef;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
            font-weight: bold;
        }

        .answer-option:hover {
            border-color: #4facfe;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 172, 254, 0.2);
        }

        .answer-option.selected {
            border-color: #4facfe;
            background: #e3f2fd;
        }

        .answer-option.correct {
            border-color: #28a745;
            background: #d4edda;
        }

        .answer-option.incorrect {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 172, 254, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            width: 100%;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #4facfe;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.9em;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1em;
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .settings-panel {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e9ecef;
            }
            
            .answers-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìè –¢—Ä–µ–Ω–∞–∂–µ—Ä –µ–¥–∏–Ω–∏—Ü –¥–ª–∏–Ω—ã</h1>
            <p>–ò–∑—É—á–∞–π—Ç–µ –æ—Ç—Ä–µ–∑–∫–∏ –∏ –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–µ–π —Å—Ö–µ–º—ã!</p>
        </div>

        <div class="main-content">
            <div class="settings-panel">
                <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                
                <div class="setting-group">
                    <label>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="convertCmToDm">
                            <label for="convertCmToDm">–ü–µ—Ä–µ–≤–æ–¥–∏—Ç—å —Å–º –≤ –¥–º</label>
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <label>–†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã:</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="allowKm">
                            <label for="allowKm">–ö–∏–ª–æ–º–µ—Ç—Ä—ã (–∫–º)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allowM" checked>
                            <label for="allowM">–ú–µ—Ç—Ä—ã (–º)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allowDm" checked>
                            <label for="allowDm">–î–µ—Ü–∏–º–µ—Ç—Ä—ã (–¥–º)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allowCm" checked>
                            <label for="allowCm">–°–∞–Ω—Ç–∏–º–µ—Ç—Ä—ã (—Å–º)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allowMm">
                            <label for="allowMm">–ú–∏–ª–ª–∏–º–µ—Ç—Ä—ã (–º–º)</label>
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–¥–∏–Ω–∏—Ü –≤ –æ—Ç—Ä–µ–∑–∫–µ:</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="number" id="minUnits" value="1" min="1" max="4" style="width: 60px;">
                        <span>–¥–æ</span>
                        <input type="number" id="maxUnits" value="3" min="1" max="4" style="width: 60px;">
                    </div>
                </div>

                <div class="setting-group">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤:</label>
                    <input type="number" id="answerOptionsCount" value="6" min="3" max="10" style="width: 80px;">
                </div>

                <div class="setting-group">
                    <label>–î–∏–∞–ø–∞–∑–æ–Ω—ã –µ–¥–∏–Ω–∏—Ü:</label>
                    <div class="unit-ranges">
                        <div class="unit-range">
                            <label>–ö–∏–ª–æ–º–µ—Ç—Ä—ã (–∫–º):</label>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="number" id="kmMin" value="1" min="1" max="100" style="width: 50px;">
                                <span>-</span>
                                <input type="number" id="kmMax" value="20" min="1" max="100" style="width: 50px;">
                            </div>
                        </div>
                        <div class="unit-range">
                            <label>–ú–µ—Ç—Ä—ã (–º):</label>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="number" id="mMin" value="1" min="1" max="1000" style="width: 50px;">
                                <span>-</span>
                                <input type="number" id="mMax" value="20" min="1" max="1000" style="width: 50px;">
                            </div>
                        </div>
                        <div class="unit-range">
                            <label>–î–µ—Ü–∏–º–µ—Ç—Ä—ã (–¥–º):</label>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="number" id="dmMin" value="1" min="1" max="100" style="width: 50px;">
                                <span>-</span>
                                <input type="number" id="dmMax" value="9" min="1" max="100" style="width: 50px;">
                            </div>
                        </div>
                        <div class="unit-range">
                            <label>–°–∞–Ω—Ç–∏–º–µ—Ç—Ä—ã (—Å–º):</label>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="number" id="cmMin" value="1" min="1" max="100" style="width: 50px;">
                                <span>-</span>
                                <input type="number" id="cmMax" value="99" min="1" max="100" style="width: 50px;">
                            </div>
                        </div>
                        <div class="unit-range">
                            <label>–ú–∏–ª–ª–∏–º–µ—Ç—Ä—ã (–º–º):</label>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="number" id="mmMin" value="1" min="1" max="100" style="width: 50px;">
                                <span>-</span>
                                <input type="number" id="mmMax" value="9" min="1" max="100" style="width: 50px;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="game-area">
                <div class="task-display">
                    <div class="task-question" id="taskQuestion">
                        –ù–∞–∂–º–∏—Ç–µ "–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞" –¥–ª—è –Ω–∞—á–∞–ª–∞
                    </div>
                    
                    <div class="controls">
                        <button class="btn btn-primary" id="newTaskBtn">üéØ –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</button>
                        <button class="btn btn-secondary" id="showAnswerBtn" disabled>üí° –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç</button>
                    </div>
                    
                    <div class="diagram-container">
                        <svg class="diagram-svg" id="diagramSvg" viewBox="0 0 1000 500">
                            <!-- –§–æ–Ω -->
                            <rect fill="#fff" width="1000" height="500"/>
                            
                            <!-- –û—Ç—Ä–µ–∑–æ–∫ AC (–∑–µ–ª–µ–Ω—ã–π, —Å–≤–µ—Ä—Ö—É) -->
                            <line id="segmentAC" x1="100" y1="150" x2="900" y2="150" stroke="#00ff00" stroke-width="10"/>
                            
                            <!-- –û—Ç—Ä–µ–∑–æ–∫ AB (—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π, —Å–Ω–∏–∑—É —Å–ª–µ–≤–∞) -->
                            <line id="segmentAB" x1="100" y1="300" x2="500" y2="300" stroke="#bf00bf" stroke-width="8"/>
                            
                            <!-- –û—Ç—Ä–µ–∑–æ–∫ BC (—Å–∏–Ω–∏–π, —Å–Ω–∏–∑—É —Å–ø—Ä–∞–≤–∞) -->
                            <line id="segmentBC" x1="500" y1="300" x2="900" y2="300" stroke="#0000bf" stroke-width="8"/>
                            
                            <!-- –¢–æ—á–∫–∞ A -->
                            <circle id="pointA" cx="100" cy="150" r="10" fill="#000"/>
                            <circle cx="100" cy="300" r="10" fill="#000"/>
                            
                            <!-- –¢–æ—á–∫–∞ B -->
                            <circle id="pointB" cx="500" cy="300" r="10" fill="#000"/>
                            
                            <!-- –¢–æ—á–∫–∞ C -->
                            <circle id="pointC" cx="900" cy="150" r="10" fill="#000"/>
                            <circle cx="900" cy="300" r="10" fill="#000"/>
                            
                            <!-- –ü–æ–¥–ø–∏—Å–∏ —Ç–æ—á–µ–∫ -->
                            <text x="100" y="130" text-anchor="middle" font-size="24" font-weight="bold" fill="#000">A</text>
                            <text x="100" y="280" text-anchor="middle" font-size="24" font-weight="bold" fill="#000">A</text>
                            <!-- –ü–æ–¥–ø–∏—Å—å —Ç–æ—á–∫–∏ B –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            <text x="900" y="130" text-anchor="middle" font-size="24" font-weight="bold" fill="#000">C</text>
                            <text x="900" y="280" text-anchor="middle" font-size="24" font-weight="bold" fill="#000">C</text>
                            
                            <!-- –ü–æ–¥–ø–∏—Å–∏ –æ—Ç—Ä–µ–∑–∫–æ–≤ -->
                            <text id="labelAC" x="500" y="100" text-anchor="middle" font-size="20" font-weight="bold" fill="#000">AC: ?</text>
                            <text id="labelAB" x="300" y="250" text-anchor="middle" font-size="20" font-weight="bold" fill="#000">AB: ?</text>
                            <text id="labelBC" x="700" y="250" text-anchor="middle" font-size="20" font-weight="bold" fill="#000">BC: ?</text>
                        </svg>
                    </div>

                    <div class="questions-container">
                        <div class="question-block">
                            <h4>–í–æ–ø—Ä–æ—Å 1: –ù–∞–π–¥–∏—Ç–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –æ—Ç—Ä–µ–∑–æ–∫</h4>
                            <div class="answers-container" id="answersContainer1">
                                <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ -->
                            </div>
                        </div>
                        
                        <div class="question-block">
                            <h4>–í–æ–ø—Ä–æ—Å 2: –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–Ω–æ—Å—Ç—å –æ—Ç—Ä–µ–∑–∫–æ–≤ AB –∏ BC</h4>
                            <div class="answers-container" id="answersContainer2">
                                <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="feedback" id="feedback" style="display: none;"></div>

                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="correctCount">0</div>
                        <div class="stat-label">–ü—Ä–∞–≤–∏–ª—å–Ω–æ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalCount">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="accuracy">0%</div>
                        <div class="stat-label">–¢–æ—á–Ω–æ—Å—Ç—å</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class LengthTrainerSVG {
            constructor() {
                this.currentTask = null;
                this.selectedAnswer1 = null;
                this.selectedAnswer2 = null;
                this.stats = {
                    correct: 0,
                    total: 0
                };
                
                this.initializeElements();
                this.bindEvents();
                this.updateStats();
            }

            initializeElements() {
                this.taskQuestion = document.getElementById('taskQuestion');
                this.diagramSvg = document.getElementById('diagramSvg');
                this.segmentAC = document.getElementById('segmentAC');
                this.segmentAB = document.getElementById('segmentAB');
                this.segmentBC = document.getElementById('segmentBC');
                this.labelAC = document.getElementById('labelAC');
                this.labelAB = document.getElementById('labelAB');
                this.labelBC = document.getElementById('labelBC');
                this.answersContainer1 = document.getElementById('answersContainer1');
                this.answersContainer2 = document.getElementById('answersContainer2');
                this.feedback = document.getElementById('feedback');
                
                this.newTaskBtn = document.getElementById('newTaskBtn');
                this.checkAnswerBtn = document.getElementById('checkAnswerBtn');
                this.showAnswerBtn = document.getElementById('showAnswerBtn');
                
                this.correctCount = document.getElementById('correctCount');
                this.totalCount = document.getElementById('totalCount');
                this.accuracy = document.getElementById('accuracy');
            }

            bindEvents() {
                this.newTaskBtn.addEventListener('click', () => this.generateNewTask());
                this.showAnswerBtn.addEventListener('click', () => this.showAnswer());
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
                this.addSettingsValidation();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–¥–ø–∏—Å—å —Ç–æ—á–∫–∏ B
                this.initializePointBLabel();
            }

            addSettingsValidation() {
                // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –µ–¥–∏–Ω–∏—Ü
                const minUnits = document.getElementById('minUnits');
                const maxUnits = document.getElementById('maxUnits');
                
                minUnits.addEventListener('change', () => {
                    if (parseInt(minUnits.value) > parseInt(maxUnits.value)) {
                        maxUnits.value = minUnits.value;
                    }
                });
                
                maxUnits.addEventListener('change', () => {
                    if (parseInt(maxUnits.value) < parseInt(minUnits.value)) {
                        minUnits.value = maxUnits.value;
                    }
                });
                
                // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤
                const answerOptionsCount = document.getElementById('answerOptionsCount');
                answerOptionsCount.addEventListener('change', () => {
                    const value = parseInt(answerOptionsCount.value);
                    if (value < 3) {
                        answerOptionsCount.value = 3;
                    } else if (value > 10) {
                        answerOptionsCount.value = 10;
                    }
                });
                
                // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –µ–¥–∏–Ω–∏—Ü
                const unitRanges = ['km', 'm', 'dm', 'cm', 'mm'];
                
                unitRanges.forEach(unit => {
                    const minInput = document.getElementById(`${unit}Min`);
                    const maxInput = document.getElementById(`${unit}Max`);
                    
                    minInput.addEventListener('change', () => {
                        if (parseInt(minInput.value) > parseInt(maxInput.value)) {
                            maxInput.value = minInput.value;
                        }
                    });
                    
                    maxInput.addEventListener('change', () => {
                        if (parseInt(maxInput.value) < parseInt(minInput.value)) {
                            minInput.value = maxInput.value;
                        }
                    });
                });
            }

            initializePointBLabel() {
                // –°–æ–∑–¥–∞–µ–º –ø–æ–¥–ø–∏—Å—å —Ç–æ—á–∫–∏ B
                const bLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                bLabel.setAttribute('x', 500); // –Ω–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –ø–æ —Ü–µ–Ω—Ç—Ä—É
                bLabel.setAttribute('y', 280);
                bLabel.setAttribute('text-anchor', 'middle');
                bLabel.setAttribute('font-size', '24');
                bLabel.setAttribute('font-weight', 'bold');
                bLabel.setAttribute('fill', '#000');
                bLabel.setAttribute('data-point', 'B');
                bLabel.textContent = 'B';
                this.diagramSvg.appendChild(bLabel);
            }

            // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è
            convertToMm(value, unit) {
                const conversions = {
                    '–∫–º': 1000000,
                    '–º': 1000,
                    '–¥–º': 100,
                    '—Å–º': 10,
                    '–º–º': 1
                };
                return value * conversions[unit];
            }

            convertFromMm(value, unit) {
                const conversions = {
                    '–∫–º': 1000000,
                    '–º': 1000,
                    '–¥–º': 100,
                    '—Å–º': 10,
                    '–º–º': 1
                };
                return value / conversions[unit];
            }

            formatLength(mm, format = 'mixed') {
                if (format === 'mm') return `${mm} –º–º`;
                if (format === 'cm') return `${mm / 10} —Å–º`;
                if (format === 'dm') return `${mm / 100} –¥–º`;
                
                // –°–º–µ—à–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å —É—á–µ—Ç–æ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∞ —Å–º –≤ –¥–º
                let result = '';
                let remaining = mm;
                
                const convertCmToDm = document.getElementById('convertCmToDm').checked;
                
                // –°–Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ–≤–æ–¥–∏–º –≤ –∫–∏–ª–æ–º–µ—Ç—Ä—ã –∏ –º–µ—Ç—Ä—ã
                const km = Math.floor(remaining / 1000000);
                if (km > 0) {
                    result += `${km} –∫–º `;
                    remaining %= 1000000;
                }
                
                const m = Math.floor(remaining / 1000);
                if (m > 0) {
                    result += `${m} –º `;
                    remaining %= 1000;
                }
                
                // –¢–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –µ–¥–∏–Ω–∏—Ü—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                if (convertCmToDm) {
                    // –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞, –ø–µ—Ä–µ–≤–æ–¥–∏–º –∫–∞–∫ –æ–±—ã—á–Ω–æ
                    const dm = Math.floor(remaining / 100);
                    if (dm > 0) {
                        result += `${dm} –¥–º `;
                        remaining %= 100;
                    }
                    
                    const cm = Math.floor(remaining / 10);
                    if (cm > 0) {
                        result += `${cm} —Å–º `;
                        remaining %= 10;
                    }
                    
                    if (remaining > 0) {
                        result += `${remaining} –º–º `;
                    }
                } else {
                    // –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞, –ø–µ—Ä–µ–≤–æ–¥–∏–º —Ç–æ–ª—å–∫–æ –º–º –≤ —Å–º
                    const cm = Math.floor(remaining / 10);
                    if (cm > 0) {
                        result += `${cm} —Å–º `;
                        remaining %= 10;
                    }
                    
                    if (remaining > 0) {
                        result += `${remaining} –º–º `;
                    }
                }
                
                return result.trim() || '0 –º–º';
            }

            generateRandomLength() {
                const allowedUnits = this.getAllowedUnits();
                const minUnits = parseInt(document.getElementById('minUnits').value);
                const maxUnits = parseInt(document.getElementById('maxUnits').value);
                
                if (allowedUnits.length === 0) return { value: 0, unit: '–º–º', mm: 0 };
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–¥–∏–Ω–∏—Ü –¥–ª—è —ç—Ç–æ–≥–æ –æ—Ç—Ä–µ–∑–∫–∞
                const numUnits = Math.floor(Math.random() * (maxUnits - minUnits + 1)) + minUnits;
                const selectedUnits = this.selectRandomUnits(allowedUnits, numUnits);
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –µ–¥–∏–Ω–∏—Ü—ã
                let totalMm = 0;
                const units = [];
                
                for (const unit of selectedUnits) {
                    const min = this.getUnitMin(unit);
                    const max = this.getUnitMax(unit);
                    const value = Math.floor(Math.random() * (max - min + 1)) + min;
                    const mm = this.convertToMm(value, unit);
                    
                    units.push({ value, unit, mm });
                    totalMm += mm;
                }
                
                return {
                    units: units,
                    mm: totalMm,
                    formatted: this.formatMixedLength(units)
                };
            }

            selectRandomUnits(allowedUnits, numUnits) {
                const shuffled = [...allowedUnits].sort(() => Math.random() - 0.5);
                return shuffled.slice(0, Math.min(numUnits, allowedUnits.length));
            }

            getUnitMin(unit) {
                const minIds = {
                    '–∫–º': 'kmMin',
                    '–º': 'mMin',
                    '–¥–º': 'dmMin',
                    '—Å–º': 'cmMin',
                    '–º–º': 'mmMin'
                };
                return parseInt(document.getElementById(minIds[unit]).value);
            }

            getUnitMax(unit) {
                const maxIds = {
                    '–∫–º': 'kmMax',
                    '–º': 'mMax',
                    '–¥–º': 'dmMax',
                    '—Å–º': 'cmMax',
                    '–º–º': 'mmMax'
                };
                return parseInt(document.getElementById(maxIds[unit]).value);
            }

            formatMixedLength(units, normalize = false) {
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –µ–¥–∏–Ω–∏—Ü—ã –æ—Ç –±–æ–ª—å—à–∏—Ö –∫ –º–µ–Ω—å—à–∏–º (–∫–º > –º > –¥–º > —Å–º > –º–º)
                const unitOrder = { '–∫–º': 5, '–º': 4, '–¥–º': 3, '—Å–º': 2, '–º–º': 1 };
                let sortedUnits = units.sort((a, b) => unitOrder[b.unit] - unitOrder[a.unit]);
                
                // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å (–ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –º–µ–Ω—å—à–∏–µ –µ–¥–∏–Ω–∏—Ü—ã –≤ —Å—Ç–∞—Ä—à–∏–µ)
                if (normalize) {
                    sortedUnits = this.normalizeUnits(sortedUnits);
                }
                
                let result = '';
                for (const unit of sortedUnits) {
                    if (unit.value > 0) {
                        result += `${unit.value} ${unit.unit} `;
                    }
                }
                
                return result.trim() || '0 –º–º';
            }

            normalizeUnits(units) {
                // –°–Ω–∞—á–∞–ª–∞ –≤—ã—á–∏—Å–ª—è–µ–º –æ–±—â—É—é –¥–ª–∏–Ω—É –≤ –º–∏–ª–ª–∏–º–µ—Ç—Ä–∞—Ö
                let totalMm = 0;
                for (const unit of units) {
                    totalMm += unit.mm;
                }
                
                // –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ —Ü–µ–ª—ã—Ö –º–∏–ª–ª–∏–º–µ—Ç—Ä–æ–≤ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –æ—à–∏–±–æ–∫ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
                totalMm = Math.round(totalMm);
                
                // –°–æ–∑–¥–∞–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã, –Ω–∞—á–∏–Ω–∞—è —Å —Å–∞–º—ã—Ö –±–æ–ª—å—à–∏—Ö
                const normalizedUnits = [];
                const convertCmToDm = document.getElementById('convertCmToDm').checked;
                
                let remaining = totalMm;
                
                // –°–Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ–≤–æ–¥–∏–º –≤ –∫–∏–ª–æ–º–µ—Ç—Ä—ã –∏ –º–µ—Ç—Ä—ã
                const km = Math.floor(remaining / 1000000);
                if (km > 0) {
                    normalizedUnits.push({
                        value: km,
                        unit: '–∫–º',
                        mm: km * 1000000
                    });
                    remaining %= 1000000;
                }
                
                const m = Math.floor(remaining / 1000);
                if (m > 0) {
                    normalizedUnits.push({
                        value: m,
                        unit: '–º',
                        mm: m * 1000
                    });
                    remaining %= 1000;
                }
                
                // –¢–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –µ–¥–∏–Ω–∏—Ü—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                if (convertCmToDm) {
                    // –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞, –ø–µ—Ä–µ–≤–æ–¥–∏–º –∫–∞–∫ –æ–±—ã—á–Ω–æ
                    const dm = Math.floor(remaining / 100);
                    if (dm > 0) {
                        normalizedUnits.push({
                            value: dm,
                            unit: '–¥–º',
                            mm: dm * 100
                        });
                        remaining %= 100;
                    }
                    
                    const cm = Math.floor(remaining / 10);
                    if (cm > 0) {
                        normalizedUnits.push({
                            value: cm,
                            unit: '—Å–º',
                            mm: cm * 10
                        });
                        remaining %= 10;
                    }
                    
                    if (remaining > 0) {
                        normalizedUnits.push({
                            value: remaining,
                            unit: '–º–º',
                            mm: remaining
                        });
                    }
                } else {
                    // –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞, –ø–µ—Ä–µ–≤–æ–¥–∏–º —Ç–æ–ª—å–∫–æ –º–º –≤ —Å–º
                    const cm = Math.floor(remaining / 10);
                    if (cm > 0) {
                        normalizedUnits.push({
                            value: cm,
                            unit: '—Å–º',
                            mm: cm * 10
                        });
                        remaining %= 10;
                    }
                    
                    if (remaining > 0) {
                        normalizedUnits.push({
                            value: remaining,
                            unit: '–º–º',
                            mm: remaining
                        });
                    }
                }
                
                return normalizedUnits;
            }

            getNextHigherUnit(unit) {
                const hierarchy = {
                    '–º–º': '—Å–º',
                    '—Å–º': '–¥–º', 
                    '–¥–º': '–º',
                    '–º': '–∫–º',
                    '–∫–º': null
                };
                return hierarchy[unit];
            }

            getAllowedUnits() {
                const units = [];
                if (document.getElementById('allowKm').checked) units.push('–∫–º');
                if (document.getElementById('allowM').checked) units.push('–º');
                if (document.getElementById('allowDm').checked) units.push('–¥–º');
                if (document.getElementById('allowCm').checked) units.push('—Å–º');
                if (document.getElementById('allowMm').checked) units.push('–º–º');
                return units;
            }

            generateNewTask() {
                this.selectedAnswer1 = null;
                this.selectedAnswer2 = null;
                this.feedback.style.display = 'none';
                this.showAnswerBtn.disabled = true;
                
                this.generateTask();
                this.updateDiagramDisplay();
                this.generateAnswerOptions();
            }

            generateTask() {
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–≤–∞ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –æ—Ç—Ä–µ–∑–∫–∞
                const ab = this.generateRandomLength();
                const bc = this.generateRandomLength();
                
                // –°–æ–∑–¥–∞–µ–º –æ—Ç—Ä–µ–∑–æ–∫ AC –∫–∞–∫ —Å—É–º–º—É AB –∏ BC
                const ac = {
                    mm: ab.mm + bc.mm,
                    units: this.combineUnits(ab.units, bc.units),
                    formatted: this.formatMixedLength(this.combineUnits(ab.units, bc.units))
                };
                
                // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –æ—Ç—Ä–µ–∑–æ–∫
                const unknownSegments = ['AB', 'BC', 'AC'];
                const unknownSegment = unknownSegments[Math.floor(Math.random() * unknownSegments.length)];
                
                this.currentTask = {
                    ab,
                    bc,
                    ac,
                    unknownSegment,
                    correctAnswer1: this.getSegmentValue(unknownSegment, ab, bc, ac),
                    correctAnswer2: Math.abs(ab.mm - bc.mm)
                };
                
                this.taskQuestion.textContent = `–ù–∞–π–¥–∏—Ç–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –æ—Ç—Ä–µ–∑–æ–∫ –∏ —Ä–∞–∑–Ω–æ—Å—Ç—å AB –∏ BC`;
            }

            combineUnits(units1, units2) {
                // –û–±—ä–µ–¥–∏–Ω—è–µ–º –µ–¥–∏–Ω–∏—Ü—ã –∏–∑ –¥–≤—É—Ö –æ—Ç—Ä–µ–∑–∫–æ–≤
                const combined = [...units1, ...units2];
                const result = {};
                
                // –°—É–º–º–∏—Ä—É–µ–º –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –µ–¥–∏–Ω–∏—Ü—ã
                for (const unit of combined) {
                    if (result[unit.unit]) {
                        result[unit.unit].value += unit.value;
                        result[unit.unit].mm += unit.mm;
                    } else {
                        result[unit.unit] = { ...unit };
                    }
                }
                
                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ –º–∞—Å—Å–∏–≤ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º (–ø–µ—Ä–µ–≤–æ–¥–∏–º –º–µ–Ω—å—à–∏–µ –µ–¥–∏–Ω–∏—Ü—ã –≤ —Å—Ç–∞—Ä—à–∏–µ)
                const unitOrder = { '–∫–º': 5, '–º': 4, '–¥–º': 3, '—Å–º': 2, '–º–º': 1 };
                const combinedUnits = Object.values(result).sort((a, b) => unitOrder[b.unit] - unitOrder[a.unit]);
                
                return this.normalizeUnits(combinedUnits);
            }

            getSegmentValue(segment, ab, bc, ac) {
                switch(segment) {
                    case 'AB': return ab;
                    case 'BC': return bc;
                    case 'AC': return ac;
                    default: return { mm: 0, formatted: '0 –º–º' };
                }
            }

            updateDiagramDisplay() {
                const { ab, bc, ac, unknownSegment } = this.currentTask;
                
                // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Ç–æ—á–∫–∏ B –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è AB/BC
                const totalLength = ab.mm + bc.mm;
                const abRatio = ab.mm / totalLength;
                const bcRatio = bc.mm / totalLength;
                
                // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ç–æ—á–µ–∫ A –∏ C (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
                const ax = 100;
                const cx = 900;
                const y = 300; // y-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ –¥–ª—è –Ω–∏–∂–Ω–µ–π –ª–∏–Ω–∏–∏
                
                // –í—ã—á–∏—Å–ª—è–µ–º x-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—É —Ç–æ—á–∫–∏ B
                const bx = ax + (cx - ax) * abRatio;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Ç–æ—á–∫–∏ B
                const pointB = document.getElementById('pointB');
                pointB.setAttribute('cx', bx);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –æ—Ç—Ä–µ–∑–∫–∞ AB
                this.segmentAB.setAttribute('x1', ax);
                this.segmentAB.setAttribute('x2', bx);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –æ—Ç—Ä–µ–∑–∫–∞ BC
                this.segmentBC.setAttribute('x1', bx);
                this.segmentBC.setAttribute('x2', cx);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –ø–æ–¥–ø–∏—Å–µ–π –æ—Ç—Ä–µ–∑–∫–æ–≤
                this.labelAB.setAttribute('x', ax + (bx - ax) / 2);
                this.labelBC.setAttribute('x', bx + (cx - bx) / 2);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –ø–æ–¥–ø–∏—Å–∏ —Ç–æ—á–∫–∏ B
                const pointBLabel = this.diagramSvg.querySelector('text[data-point="B"]');
                if (pointBLabel) {
                    pointBLabel.setAttribute('x', bx);
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è
                const showValue = (segment, value) => {
                    if (segment === unknownSegment) {
                        return '?';
                    }
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
                    if (value.formatted) {
                        return value.formatted;
                    }
                    return this.formatLength(value.mm, 'mixed');
                };
                
                this.labelAC.textContent = `AC: ${showValue('AC', ac)}`;
                this.labelAB.textContent = `AB: ${showValue('AB', ab)}`;
                this.labelBC.textContent = `BC: ${showValue('BC', bc)}`;
            }

            generateAnswerOptions() {
                const { correctAnswer1, correctAnswer2, ab, bc, ac } = this.currentTask;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –µ–¥–∏–Ω–∏—Ü—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –æ—Ç—Ä–µ–∑–∫–∞—Ö
                const usedUnits = this.getUsedUnits(ab, bc, ac);
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ (–Ω–∞–π—Ç–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –æ—Ç—Ä–µ–∑–æ–∫)
                this.generateQuestionOptions(this.answersContainer1, correctAnswer1, 1, usedUnits);
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ (—Ä–∞–∑–Ω–æ—Å—Ç—å –æ—Ç—Ä–µ–∑–∫–æ–≤)
                this.generateQuestionOptions(this.answersContainer2, correctAnswer2, 2, usedUnits);
            }

            getUsedUnits(ab, bc, ac) {
                const units = new Set();
                
                // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –µ–¥–∏–Ω–∏—Ü—ã –∏–∑ –æ—Ç—Ä–µ–∑–∫–æ–≤
                [ab, bc, ac].forEach(segment => {
                    if (segment.units) {
                        segment.units.forEach(unit => {
                            if (unit.value > 0) {
                                units.add(unit.unit);
                            }
                        });
                    }
                });
                
                return Array.from(units);
            }

            generateQuestionOptions(container, correctAnswer, questionNum, usedUnits = null) {
                container.innerHTML = '';
                
                let correctAnswerFormatted;
                
                // –ï—Å–ª–∏ correctAnswer - —ç—Ç–æ –æ–±—ä–µ–∫—Ç —Å –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
                if (typeof correctAnswer === 'object' && correctAnswer.formatted) {
                    correctAnswerFormatted = correctAnswer.formatted;
                } else {
                    // –ï—Å–ª–∏ —ç—Ç–æ —á–∏—Å–ª–æ (—Å—Ç–∞—Ä–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
                    correctAnswerFormatted = this.formatLength(correctAnswer, 'mixed');
                }
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å —É—á–µ—Ç–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –µ–¥–∏–Ω–∏—Ü
                const wrongAnswers = this.generateWrongAnswers(correctAnswer, usedUnits);
                
                // –°–º–µ—à–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
                const allAnswers = [correctAnswerFormatted, ...wrongAnswers];
                this.shuffleArray(allAnswers);
                
                allAnswers.forEach((answer, index) => {
                    const option = document.createElement('div');
                    option.className = 'answer-option';
                    option.textContent = answer;
                    option.dataset.answer = answer;
                    option.dataset.question = questionNum;
                    option.addEventListener('click', () => this.selectAnswer(option));
                    container.appendChild(option);
                });
            }

            generateWrongAnswers(correctAnswer, usedUnits = null) {
                const wrongAnswers = [];
                const variations = [0.5, 0.8, 1.2, 1.5, 2, 0.1, 0.9, 0.3, 0.7, 1.3, 1.7, 2.5, 3, 0.4, 0.6, 0.9, 1.1, 1.4, 1.6, 1.8, 2.2, 2.8, 3.5];
                
                // –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
                const answerOptionsCount = parseInt(document.getElementById('answerOptionsCount').value);
                const wrongAnswersCount = answerOptionsCount - 1; // -1 –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
                
                // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –º–∏–ª–ª–∏–º–µ—Ç—Ä–∞—Ö –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
                let correctAnswerMm;
                if (typeof correctAnswer === 'object' && correctAnswer.mm !== undefined) {
                    correctAnswerMm = correctAnswer.mm;
                } else {
                    correctAnswerMm = correctAnswer;
                }
                
                for (let i = 0; i < wrongAnswersCount; i++) {
                    const variation = variations[Math.floor(Math.random() * variations.length)];
                    const wrongAnswerMm = Math.round(correctAnswerMm * variation);
                    
                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç —Å —É—á–µ—Ç–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –µ–¥–∏–Ω–∏—Ü
                    if (usedUnits && usedUnits.length > 0) {
                        wrongAnswers.push(this.formatLengthWithUnits(wrongAnswerMm, usedUnits));
                    } else {
                        wrongAnswers.push(this.formatLength(wrongAnswerMm, 'mixed'));
                    }
                }
                
                return wrongAnswers;
            }

            formatLengthWithUnits(mm, usedUnits) {
                // –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ —Ü–µ–ª—ã—Ö –º–∏–ª–ª–∏–º–µ—Ç—Ä–æ–≤
                const roundedMm = Math.round(mm);
                
                // –°–æ–∑–¥–∞–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã, –∏—Å–ø–æ–ª—å–∑—É—è —Ç–æ–ª—å–∫–æ —Ç–µ –µ–¥–∏–Ω–∏—Ü—ã, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –≤ –∑–∞–¥–∞—á–µ
                const normalizedUnits = [];
                const convertCmToDm = document.getElementById('convertCmToDm').checked;
                
                let remaining = roundedMm;
                
                // –°–Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ–≤–æ–¥–∏–º –≤ –∫–∏–ª–æ–º–µ—Ç—Ä—ã –∏ –º–µ—Ç—Ä—ã
                if (usedUnits.includes('–∫–º')) {
                    const km = Math.floor(remaining / 1000000);
                    if (km > 0) {
                        normalizedUnits.push({
                            value: km,
                            unit: '–∫–º',
                            mm: km * 1000000
                        });
                        remaining %= 1000000;
                    }
                }
                
                if (usedUnits.includes('–º')) {
                    const m = Math.floor(remaining / 1000);
                    if (m > 0) {
                        normalizedUnits.push({
                            value: m,
                            unit: '–º',
                            mm: m * 1000
                        });
                        remaining %= 1000;
                    }
                }
                
                // –¢–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –µ–¥–∏–Ω–∏—Ü—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                if (convertCmToDm) {
                    // –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞, –ø–µ—Ä–µ–≤–æ–¥–∏–º –∫–∞–∫ –æ–±—ã—á–Ω–æ
                    if (usedUnits.includes('–¥–º')) {
                        const dm = Math.floor(remaining / 100);
                        if (dm > 0) {
                            normalizedUnits.push({
                                value: dm,
                                unit: '–¥–º',
                                mm: dm * 100
                            });
                            remaining %= 100;
                        }
                    }
                    
                    if (usedUnits.includes('—Å–º')) {
                        const cm = Math.floor(remaining / 10);
                        if (cm > 0) {
                            normalizedUnits.push({
                                value: cm,
                                unit: '—Å–º',
                                mm: cm * 10
                            });
                            remaining %= 10;
                        }
                    }
                    
                    if (usedUnits.includes('–º–º') && remaining > 0) {
                        normalizedUnits.push({
                            value: remaining,
                            unit: '–º–º',
                            mm: remaining
                        });
                    }
                } else {
                    // –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞, –ø–µ—Ä–µ–≤–æ–¥–∏–º —Ç–æ–ª—å–∫–æ –º–º –≤ —Å–º
                    if (usedUnits.includes('—Å–º')) {
                        const cm = Math.floor(remaining / 10);
                        if (cm > 0) {
                            normalizedUnits.push({
                                value: cm,
                                unit: '—Å–º',
                                mm: cm * 10
                            });
                            remaining %= 10;
                        }
                    }
                    
                    if (usedUnits.includes('–º–º') && remaining > 0) {
                        normalizedUnits.push({
                            value: remaining,
                            unit: '–º–º',
                            mm: remaining
                        });
                    }
                }
                
                return this.formatMixedLength(normalizedUnits, false);
            }

            getUnitValue(unit) {
                const conversions = {
                    '–∫–º': 1000000,
                    '–º': 1000,
                    '–¥–º': 100,
                    '—Å–º': 10,
                    '–º–º': 1
                };
                return conversions[unit];
            }

            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            selectAnswer(option) {
                const questionNum = option.dataset.question;
                
                // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ç–æ–≥–æ –∂–µ –≤–æ–ø—Ä–æ—Å–∞
                document.querySelectorAll(`[data-question="${questionNum}"]`).forEach(opt => {
                    opt.classList.remove('selected', 'correct', 'incorrect');
                });
                
                // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
                option.classList.add('selected');
                
                if (questionNum === '1') {
                    this.selectedAnswer1 = option.dataset.answer;
                } else {
                    this.selectedAnswer2 = option.dataset.answer;
                }
                
                // –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞
                this.checkAnswerInstantly(option, questionNum);
                
                // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–∫–∞–∑–∞ –æ—Ç–≤–µ—Ç–∞ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω—ã –æ–±–∞ –æ—Ç–≤–µ—Ç–∞
                this.showAnswerBtn.disabled = !(this.selectedAnswer1 && this.selectedAnswer2);
            }

            checkAnswerInstantly(option, questionNum) {
                const { correctAnswer1, correctAnswer2 } = this.currentTask;
                
                const correctAnswer = questionNum === '1' ? correctAnswer1 : correctAnswer2;
                
                let correctAnswerFormatted;
                if (typeof correctAnswer === 'object' && correctAnswer.formatted) {
                    correctAnswerFormatted = correctAnswer.formatted;
                } else {
                    correctAnswerFormatted = this.formatLength(correctAnswer, 'mixed');
                }
                
                const isCorrect = option.dataset.answer === correctAnswerFormatted;
                
                // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –∑–µ–ª–µ–Ω—ã–º
                if (isCorrect) {
                    option.classList.add('correct');
                    this.updateStats(questionNum, true);
                } else {
                    option.classList.add('incorrect');
                    this.updateStats(questionNum, false);
                }
            }

            showAnswer() {
                const { correctAnswer1, correctAnswer2 } = this.currentTask;
                
                let correctAnswer1Formatted, correctAnswer2Formatted;
                
                if (typeof correctAnswer1 === 'object' && correctAnswer1.formatted) {
                    correctAnswer1Formatted = correctAnswer1.formatted;
                } else {
                    correctAnswer1Formatted = this.formatLength(correctAnswer1, 'mixed');
                }
                
                if (typeof correctAnswer2 === 'object' && correctAnswer2.formatted) {
                    correctAnswer2Formatted = correctAnswer2.formatted;
                } else {
                    correctAnswer2Formatted = this.formatLength(correctAnswer2, 'mixed');
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
                document.querySelectorAll('.answer-option').forEach(option => {
                    const questionNum = option.dataset.question;
                    const correctAnswer = questionNum === '1' ? correctAnswer1Formatted : correctAnswer2Formatted;
                    
                    if (option.dataset.answer === correctAnswer) {
                        option.classList.add('correct');
                    }
                });
                
                this.showAnswerBtn.disabled = true;
            }

            updateStats(questionNum, isCorrect) {
                this.stats.total++;
                if (isCorrect) {
                    this.stats.correct++;
                }
                
                this.correctCount.textContent = this.stats.correct;
                this.totalCount.textContent = this.stats.total;
                const accuracy = this.stats.total > 0 ? 
                    Math.round((this.stats.correct / this.stats.total) * 100) : 0;
                this.accuracy.textContent = `${accuracy}%`;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            new LengthTrainerSVG();
        });
    </script>
</body>
</html>
