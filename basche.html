<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>basche</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
        }
		 /* –§–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ–º */
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
            linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.1)), /* –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ */
            url('f1.jpg') center/cover no-repeat; /* –§–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ */
        z-index: -2;
    }

    /* –ü–æ–≤–µ—Ä—Ö —Ñ–æ–Ω–æ–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–±–∞–≤–∏–º –≤–∞—à –≥—Ä–∞–¥–∏–µ–Ω—Ç —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é */
    body::after {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(110, 142, 251, 0.8), rgba(167, 119, 227, 0.3));
        z-index: -1;
    }

        .container {
    max-width: 800px;
    width: 100%;
    background-color: rgba(222, 158, 255, 0.85);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
    padding: 25px;
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.18);
    text-align: center;
			margin: 200px;
        }

        h1 {
            text-align: center;
            color: #ffcc00;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .settings {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .setting-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        label {
            font-weight: bold;
            margin-right: 10px;
        }

        input, select, button {
            padding: 10px 15px;
            border-radius: 50px;
            border: none;
            font-size: 16px;
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            padding: 0;
            border-radius: 4px;
        }

        button {
            background: linear-gradient(to right, #ff8a00, #e52e71);
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            margin-top: 10px;
			margin-bottom: 15px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .game-area {
            display: none;
            flex-direction: column;
            align-items: center;
			background: rgba(0, 0, 0, 0.2);
        }

        .stones-container {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 10px;
            margin: 30px 0;
            min-height: 100px;
            max-width: 700px;
            justify-items: center;
        }

        .stone {
        width: 60px;
        height: 60px;
        background: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 36 36'><text x='18' y='26' font-size='24' text-anchor='middle' dominant-baseline='middle'>üíé</text></svg>") center/cover no-repeat;
        transition: all 0.3s;
    }

        .stone.taken {
        opacity: 0.3;
        transform: scale(0.7);
        filter: grayscale(80%);
    }

        .controls-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-label {
            font-weight: bold;
            color: #FFED00;
            min-width: 80px;
            text-align: right;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
        }

        .control-buttons button {
            width: 50px;
            height: 50px;
            font-size: 18px;
            font-weight: bold;
        }

        .control-buttons button:disabled {
            background: linear-gradient(to right, #666, #444);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .control-buttons button:disabled:hover {
            transform: none;
            box-shadow: none;
        }

        .stones-count h2 {
            font-size: 28px;
            color: #FFED00;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin: 10px 0;
        }

        .game-info {
            margin-top: 20px;
            text-align: center;
        }

        .move-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: bold;
        }

        .move-info span {
            color: #F8FF00;
        }

        .message {
            font-size: 18px;
            font-weight: bold;
            margin: 20px 0;
            text-align: center;
            min-height: 27px;
            color: #F8FF00;
        }

        .win {
            color: #4caf50;
        }

        .lose {
            color: #f44336;
        }

        .computer-move {
            color: #F8FF00;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            font-size: 16px;
        }

        @media (max-width: 600px) {
            .stone {
                width: 30px;
                height: 30px;
            }
            
            .controls button {
                width: 50px;
            }
        }
		 /* –°—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" */
        .back-button {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            font-size: 24px;
            border-radius: 50%;
            text-decoration: none;
            margin: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border: none;
        }

        .back-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
	
    <div class="container">		
        <h1>–ò–≥—Ä–∞ –ë–∞—à–µ  üíé <a href="index.html" class="back-button">‚Üê</a></h1>
        <div class="settings" id="settings">
            <div class="setting-group">
                <label for="totalStones">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–º–Ω–µ–π:</label>
                <input type="number" id="totalStones" min="5" max="50" value="15">
            </div>
            
            <div class="setting-group">
                <label for="maxTake">–ú–∞–∫—Å–∏–º—É–º –∑–∞ —Ö–æ–¥:</label>
                <input type="number" id="maxTake" min="1" max="10" value="3">
            </div>
            
            <div class="setting-group">
                <label for="gameMode">–†–µ–∂–∏–º –∏–≥—Ä—ã:</label>
                <select id="gameMode">
                    <option value="normal">–ù–æ—Ä–º–∞–ª—å–Ω—ã–π (–≤—ã–∏–≥—Ä–∞–π, –∑–∞–±—Ä–∞–≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π)</option>
                    <option value="misere">–ú–∏–∑–µ—Ä (–ø—Ä–æ–∏–≥—Ä–∞–π, –∑–∞–±—Ä–∞–≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π)</option>
                </select>
            </div>
            
            <div class="setting-group">
                <label for="playerMode">–ò–≥—Ä–æ–∫–∏:</label>
                <select id="playerMode">
                    <option value="vs_computer">–ü—Ä–æ—Ç–∏–≤ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞</option>
                    <option value="two_players">–î–≤–∞ –∏–≥—Ä–æ–∫–∞</option>
                </select>
            </div>
            
            <div class="setting-group" id="firstPlayerGroup">
                <label for="firstPlayer">–ü–µ—Ä–≤—ã–π —Ö–æ–¥:</label>
                <select id="firstPlayer">
                    <option value="computer">–ö–æ–º–ø—å—é—Ç–µ—Ä</option>
                    <option value="player">–ò–≥—Ä–æ–∫ 1</option>
                </select>
            </div>
            
            <div class="setting-group" id="difficultyGroup">
                <label for="difficulty">–°–ª–æ–∂–Ω–æ—Å—Ç—å:</label>
                <select id="difficulty">
                    <option value="easy">–õ–µ–≥–∫–∞—è</option>
                    <option value="medium" selected>–°—Ä–µ–¥–Ω—è—è</option>
                    <option value="hard">–°–ª–æ–∂–Ω–∞—è</option>
                </select>
            </div>
            
            <div class="setting-group">
                <label for="allowAdd">–†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ–∫–ª–∞–¥—ã–≤–∞—Ç—å –∫–∞–º–Ω–∏:</label>
                <input type="checkbox" id="allowAdd">
            </div>
            
            <div id="playerNamesGroup" style="display: none;">
                <div class="setting-group">
                    <label for="player1Name">–ò–≥—Ä–æ–∫ 1:</label>
                    <input type="text" id="player1Name" value="–ò–≥—Ä–æ–∫ 1" maxlength="20">
                </div>
                <div class="setting-group">
                    <label for="player2Name">–ò–≥—Ä–æ–∫ 2:</label>
                    <input type="text" id="player2Name" value="–ò–≥—Ä–æ–∫ 2" maxlength="20">
                </div>
            </div>
            
            <h3 id="gameDescription">–ó–∞–±–µ—Ä–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã</h3>
            
            <button id="startGame">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        </div>
        
        <div class="game-area" id="gameArea">
            <div class="stones-count">
                <h2>–û—Å—Ç–∞–ª–æ—Å—å –∫–∞–º–Ω–µ–π: <span id="stonesLeft">0</span></h2>
            </div>
            
            <div class="stones-container" id="stonesContainer"></div>
            
            <div class="controls-container">
                <div class="control-group" id="takeGroup">
                    <label class="control-label">–í–∑—è—Ç—å:</label>
                    <div class="control-buttons" id="takeButtons">
                        <!-- –ö–Ω–æ–ø–∫–∏ –≤–∑—è—Ç–∏—è –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
                <div class="control-group" id="addGroup" style="display: none;">
                    <label class="control-label">–î–æ–±–∞–≤–∏—Ç—å:</label>
                    <div class="control-buttons" id="addButtons">
                        <!-- –ö–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>
            
            <div class="game-info">
                <div class="move-info" id="moveInfo">
                    <span id="lastMoveInfo">–í–∞—à –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ö–æ–¥: <span id="playerLastMove">-&nbsp; &nbsp;&nbsp;</span></span>
                    <span id="computerMoveInfo">&nbsp; &nbsp;–ö–æ–º–ø—å—é—Ç–µ—Ä –≤–∑—è–ª: <span id="computerMove">-</span> –∫–∞–º–Ω–µ–π</span>
                </div>
                <div class="move-info" id="twoPlayerMoveInfo" style="display: none;">
                    <span id="player1MoveInfo">–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ö–æ–¥ <span id="player1NameSpan">–ò–≥—Ä–æ–∫ 1</span>: <span id="player1LastMove">-</span></span>
                    <span id="player2MoveInfo">&nbsp; &nbsp; &nbsp;–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ö–æ–¥ <span id="player2NameSpan">–ò–≥—Ä–æ–∫ 2</span>: <span id="player2LastMove">-</span></span>
                </div>
                <div class="message" id="message"></div>
            </div>
            
            <button id="newGame">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
        </div>
</div>

    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const settingsDiv = document.getElementById('settings');
        const gameAreaDiv = document.getElementById('gameArea');
        const stonesContainer = document.getElementById('stonesContainer');
        const takeButtons = document.getElementById('takeButtons');
        const addButtons = document.getElementById('addButtons');
        const takeGroup = document.getElementById('takeGroup');
        const addGroup = document.getElementById('addGroup');
        const messageDiv = document.getElementById('message');
        const stonesLeftSpan = document.getElementById('stonesLeft');
        const playerLastMoveSpan = document.getElementById('playerLastMove');
        const computerMoveSpan = document.getElementById('computerMove');
        const moveInfo = document.getElementById('moveInfo');
        const twoPlayerMoveInfo = document.getElementById('twoPlayerMoveInfo');
        const player1NameSpan = document.getElementById('player1NameSpan');
        const player2NameSpan = document.getElementById('player2NameSpan');
        const player1LastMove = document.getElementById('player1LastMove');
        const player2LastMove = document.getElementById('player2LastMove');
        const startGameBtn = document.getElementById('startGame');
        const newGameBtn = document.getElementById('newGame');
        const gameDescriptionH3 = document.getElementById('gameDescription');
        const gameModeSelect = document.getElementById('gameMode');
        const playerModeSelect = document.getElementById('playerMode');
        const firstPlayerGroup = document.getElementById('firstPlayerGroup');
        const difficultyGroup = document.getElementById('difficultyGroup');
        const playerNamesGroup = document.getElementById('playerNamesGroup');
        
        // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–≥—Ä—ã
        let totalStones = 15;
        let maxTake = 3;
        let firstPlayer = 'computer';
        let difficulty = 'medium';
        let gameMode = 'normal'; // normal –∏–ª–∏ misere
        let playerMode = 'vs_computer'; // vs_computer –∏–ª–∏ two_players
        let allowAdd = false;
        let stonesRemaining = 0;
        let gameActive = false;
        let currentPlayer = 'player1'; // player1, player2, computer
        let lastActionWasAdd = false; // –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
        let buttonsBlocked = false;
        let player1Name = '–ò–≥—Ä–æ–∫ 1';
        let player2Name = '–ò–≥—Ä–æ–∫ 2';
        let playerAddHistory = {}; // –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞
        let lastAddedAmount = 0; // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–º–Ω–µ–π, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–º —Ö–æ–¥—É
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        startGameBtn.addEventListener('click', startGame);
        newGameBtn.addEventListener('click', () => {
            gameAreaDiv.style.display = 'none';
            settingsDiv.style.display = 'flex';
        });
        
        gameModeSelect.addEventListener('change', updateGameDescription);
        playerModeSelect.addEventListener('change', updatePlayerModeSettings);
        
        function updateGameDescription() {
            const mode = gameModeSelect.value;
            if (mode === 'normal') {
                gameDescriptionH3.textContent = '–ó–∞–±–µ—Ä–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã';
            } else {
                gameDescriptionH3.textContent = '–ù–µ –∑–∞–±–∏—Ä–∞–π –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã';
            }
        }
        
        function updatePlayerModeSettings() {
            const mode = playerModeSelect.value;
            if (mode === 'vs_computer') {
                firstPlayerGroup.style.display = 'flex';
                difficultyGroup.style.display = 'flex';
                playerNamesGroup.style.display = 'none';
                document.getElementById('firstPlayer').innerHTML = `
                    <option value="computer">–ö–æ–º–ø—å—é—Ç–µ—Ä</option>
                    <option value="player">–ò–≥—Ä–æ–∫</option>
                `;
            } else {
                firstPlayerGroup.style.display = 'flex';
                difficultyGroup.style.display = 'none';
                playerNamesGroup.style.display = 'block';
                document.getElementById('firstPlayer').innerHTML = `
                    <option value="player1">–ò–≥—Ä–æ–∫ 1</option>
                    <option value="player2">–ò–≥—Ä–æ–∫ 2</option>
                `;
            }
        }
        
        function startGame() {
            // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            totalStones = parseInt(document.getElementById('totalStones').value);
            maxTake = parseInt(document.getElementById('maxTake').value);
            firstPlayer = document.getElementById('firstPlayer').value;
            difficulty = document.getElementById('difficulty').value;
            gameMode = document.getElementById('gameMode').value;
            playerMode = document.getElementById('playerMode').value;
            allowAdd = document.getElementById('allowAdd').checked;
            
            // –ü–æ–ª—É—á–∞–µ–º –∏–º–µ–Ω–∞ –∏–≥—Ä–æ–∫–æ–≤ –µ—Å–ª–∏ —Ä–µ–∂–∏–º –¥–≤—É—Ö –∏–≥—Ä–æ–∫–æ–≤
            if (playerMode === 'two_players') {
                player1Name = document.getElementById('player1Name').value || '–ò–≥—Ä–æ–∫ 1';
                player2Name = document.getElementById('player2Name').value || '–ò–≥—Ä–æ–∫ 2';
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –≤–≤–æ–¥–∞
            if (totalStones < maxTake + 1) {
                alert('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–º–Ω–µ–π –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –≤–∑—è—Ç–∏—è –∑–∞ —Ö–æ–¥!');
                return;
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
            stonesRemaining = totalStones;
            gameActive = true;
            currentPlayer = firstPlayer;
            lastActionWasAdd = false;
            buttonsBlocked = false;
            lastAddedAmount = 0;
            playerAddHistory = {
                player1: false,
                player2: false,
                computer: false
            };
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            settingsDiv.style.display = 'none';
            gameAreaDiv.style.display = 'flex';
            messageDiv.textContent = '';
            messageDiv.className = 'message';
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ö–æ–¥–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
            if (playerMode === 'two_players') {
                moveInfo.style.display = 'none';
                twoPlayerMoveInfo.style.display = 'flex';
                player1NameSpan.textContent = player1Name;
                player2NameSpan.textContent = player2Name;
                player1LastMove.textContent = '-';
                player2LastMove.textContent = '-';
            } else {
                moveInfo.style.display = 'flex';
                twoPlayerMoveInfo.style.display = 'none';
                playerLastMoveSpan.textContent = '-';
                computerMoveSpan.textContent = '-';
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥—Ä—É–ø–ø—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ
            if (allowAdd) {
                addGroup.style.display = 'flex';
            } else {
                addGroup.style.display = 'none';
            }
            
            updateStonesDisplay();
            updateControls();
            
            // –ï—Å–ª–∏ –ø–µ—Ä–≤—ã–π —Ö–æ–¥ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
            if (firstPlayer === 'computer' && playerMode === 'vs_computer') {
                setTimeout(computerTurn, 1000);
            } else {
                updateTurnMessage();
            }
        }
        
        function updateStonesDisplay() {
            stonesContainer.innerHTML = '';
            stonesLeftSpan.textContent = stonesRemaining;
            
            for (let i = 0; i < Math.max(totalStones, stonesRemaining); i++) {
                const stone = document.createElement('div');
                stone.className = 'stone';
                if (i >= stonesRemaining) {
                    stone.classList.add('taken');
                }
                stonesContainer.appendChild(stone);
            }
        }
        
        function updateControls() {
            takeButtons.innerHTML = '';
            addButtons.innerHTML = '';
            
            if (!gameActive || buttonsBlocked) {
                return;
            }
            
            if (playerMode === 'vs_computer' && currentPlayer === 'computer') {
                return;
            }
            
            // –ö–Ω–æ–ø–∫–∏ –¥–ª—è –≤–∑—è—Ç–∏—è –∫–∞–º–Ω–µ–π
            const maxPossibleTake = Math.min(maxTake, stonesRemaining);
            // –í—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ –≤–∑—è—Ç—å –∫–∞–º–Ω–∏, –Ω–æ –Ω–µ–ª—å–∑—è –≤–∑—è—Ç—å —Ä–æ–≤–Ω–æ —Å—Ç–æ–ª—å–∫–æ, —Å–∫–æ–ª—å–∫–æ –¥–æ–±–∞–≤–∏–ª –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏–≥—Ä–æ–∫
            const canTake = true;
            
            for (let i = 1; i <= maxPossibleTake; i++) {
                const btn = document.createElement('button');
                btn.textContent = i;
                // –ù–µ–ª—å–∑—è –≤–∑—è—Ç—å —Ä–æ–≤–Ω–æ —Å—Ç–æ–ª—å–∫–æ –∫–∞–º–Ω–µ–π, —Å–∫–æ–ª—å–∫–æ –¥–æ–±–∞–≤–∏–ª –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏–≥—Ä–æ–∫
                const isBlocked = lastAddedAmount > 0 && i === lastAddedAmount;
                btn.disabled = !canTake || isBlocked;
                if (canTake && !isBlocked) {
                    btn.addEventListener('click', () => playerTurn(i, 'take'));
                }
                takeButtons.appendChild(btn);
            }
            
            // –ö–Ω–æ–ø–∫–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞–º–Ω–µ–π (–µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ)
            if (allowAdd) {
                // –ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–ª—è—Ç—å –µ—Å–ª–∏ –∏–≥—Ä–æ–∫ –¥–æ–±–∞–≤–ª—è–ª –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ö–æ–¥
                const canAdd = !playerAddHistory[currentPlayer];
                
                for (let i = 1; i <= maxTake; i++) {
                    const btn = document.createElement('button');
                    btn.textContent = i;
                    btn.disabled = !canAdd;
                    btn.style.background = canAdd ? 
                        'linear-gradient(to right, #00c851, #007e33)' : 
                        'linear-gradient(to right, #666, #444)';
                    if (canAdd) {
                        btn.addEventListener('click', () => playerTurn(i, 'add'));
                    }
                    addButtons.appendChild(btn);
                }
            }
        }
        
        function updateTurnMessage() {
            if (playerMode === 'two_players') {
                const playerName = currentPlayer === 'player1' ? player1Name : player2Name;
                messageDiv.textContent = `–•–æ–¥: ${playerName}`;
            } else {
                messageDiv.textContent = currentPlayer === 'computer' ? '–•–æ–¥ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞...' : '–í–∞—à —Ö–æ–¥';
            }
        }
        
        function playerTurn(amount, action) {
            if (!gameActive || buttonsBlocked) return;
            
            buttonsBlocked = true;
            
            if (action === 'take') {
                stonesRemaining -= amount;
                playerAddHistory[currentPlayer] = false;
                lastAddedAmount = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º, —Ç–∞–∫ –∫–∞–∫ –≤–∑—è–ª–∏ –∫–∞–º–Ω–∏
            } else {
                stonesRemaining += amount;
                playerAddHistory[currentPlayer] = true;
                lastAddedAmount = amount; // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–∞–º–Ω–µ–π
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ö–æ–¥–∞
            const actionText = action === 'take' ? '–≤–∑—è–ª' : '–¥–æ–±–∞–≤–∏–ª';
            if (playerMode === 'vs_computer') {
                playerLastMoveSpan.textContent = `${actionText} ${amount}`;
            } else {
                // –í —Ä–µ–∂–∏–º–µ –¥–≤—É—Ö –∏–≥—Ä–æ–∫–æ–≤ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç
                if (currentPlayer === 'player1') {
                    player1LastMove.textContent = `${actionText} ${amount}`;
                } else {
                    player2LastMove.textContent = `${actionText} ${amount}`;
                }
            }
            
            updateStonesDisplay();
            
            if (stonesRemaining <= 0) {
                endGame(currentPlayer);
                return;
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∏–≥—Ä–æ–∫–∞
            if (playerMode === 'vs_computer') {
                currentPlayer = 'computer';
                setTimeout(() => {
                    computerTurn();
                }, 1000);
            } else {
                currentPlayer = currentPlayer === 'player1' ? 'player2' : 'player1';
                buttonsBlocked = false;
                updateControls();
                updateTurnMessage();
            }
        }
        
        function computerTurn() {
            if (!gameActive) return;
            
            let amount, action;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
            if (difficulty === 'easy') {
                // –°–ª—É—á–∞–π–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
                if (allowAdd && !playerAddHistory['computer'] && Math.random() > 0.7) {
                    action = 'add';
                    amount = Math.floor(Math.random() * maxTake) + 1;
                } else {
                    action = 'take';
                    amount = Math.min(Math.floor(Math.random() * maxTake) + 1, stonesRemaining);
                }
            } else {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
                const optimalMove = getOptimalMove();
                action = optimalMove.action;
                amount = optimalMove.amount;
                
                // –ù–∞ —Å—Ä–µ–¥–Ω–µ–º —É—Ä–æ–≤–Ω–µ –∏–Ω–æ–≥–¥–∞ –¥–µ–ª–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ —Ö–æ–¥—ã
                if (difficulty === 'medium' && Math.random() > 0.7) {
                    if (allowAdd && !playerAddHistory['computer'] && Math.random() > 0.5) {
                        action = 'add';
                        amount = Math.floor(Math.random() * maxTake) + 1;
                    } else {
                        action = 'take';
                        amount = Math.min(Math.floor(Math.random() * maxTake) + 1, stonesRemaining);
                    }
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ö–æ–¥–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
            if (action === 'take') {
                // –ö–æ–º–ø—å—é—Ç–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –≤–∑—è—Ç—å 0 –∫–∞–º–Ω–µ–π, –±–æ–ª—å—à–µ —á–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ, –±–æ–ª—å—à–µ –º–∞–∫—Å–∏–º—É–º–∞ –∏–ª–∏ —Ä–æ–≤–Ω–æ —Å—Ç–æ–ª—å–∫–æ, —Å–∫–æ–ª—å–∫–æ –¥–æ–±–∞–≤–∏–ª –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏–≥—Ä–æ–∫
                if (amount <= 0 || amount > stonesRemaining || amount > maxTake || (lastAddedAmount > 0 && amount === lastAddedAmount)) {
                    console.error(`–û—à–∏–±–∫–∞ –ò–ò: –ø–æ–ø—ã—Ç–∫–∞ –≤–∑—è—Ç—å ${amount} –∫–∞–º–Ω–µ–π –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö ${stonesRemaining}, lastAdded: ${lastAddedAmount}`);
                    // –ù–∞—Ö–æ–¥–∏–º –¥–æ–ø—É—Å—Ç–∏–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è –≤–∑—è—Ç–∏—è
                    let validAmount = 1;
                    for (let i = 1; i <= Math.min(maxTake, stonesRemaining); i++) {
                        if (i !== lastAddedAmount) {
                            validAmount = i;
                            break;
                        }
                    }
                    amount = validAmount;
                }
                stonesRemaining -= amount;
                playerAddHistory['computer'] = false;
                lastAddedAmount = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º, —Ç–∞–∫ –∫–∞–∫ –≤–∑—è–ª–∏ –∫–∞–º–Ω–∏
            } else {
                // –ö–æ–º–ø—å—é—Ç–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å 0 –∫–∞–º–Ω–µ–π –∏–ª–∏ –±–æ–ª—å—à–µ –º–∞–∫—Å–∏–º—É–º–∞
                if (amount <= 0 || amount > maxTake) {
                    console.error(`–û—à–∏–±–∫–∞ –ò–ò: –ø–æ–ø—ã—Ç–∫–∞ –¥–æ–±–∞–≤–∏—Ç—å ${amount} –∫–∞–º–Ω–µ–π`);
                    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º 1 –∫–∞–º–µ–Ω—å
                    amount = 1;
                }
                stonesRemaining += amount;
                playerAddHistory['computer'] = true;
                lastAddedAmount = amount; // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–∞–º–Ω–µ–π
            }
            
            const actionText = action === 'take' ? '–≤–∑—è–ª' : '–¥–æ–±–∞–≤–∏–ª';
            computerMoveSpan.textContent = `${actionText} ${amount}`;
            
            updateStonesDisplay();
            
            if (stonesRemaining <= 0) {
                endGame('computer');
                return;
            }
            
            currentPlayer = 'player1';
            buttonsBlocked = false;
            updateControls();
            updateTurnMessage();
        }
        
        function getOptimalMove() {
            // –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è –∏–≥—Ä—ã –ë–∞—à–µ
            const target = gameMode === 'normal' ? 0 : 1;
            
            if (!allowAdd) {
                // –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ë–∞—à–µ
                const remainder = stonesRemaining % (maxTake + 1);
                if (gameMode === 'normal') {
                    let takeAmount = remainder === 0 ? Math.min(maxTake, stonesRemaining) : remainder;
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –ª–∏ —ç—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
                    if (lastAddedAmount > 0 && takeAmount === lastAddedAmount) {
                        // –ò—â–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
                        for (let i = 1; i <= Math.min(maxTake, stonesRemaining); i++) {
                            if (i !== lastAddedAmount) {
                                takeAmount = i;
                                break;
                            }
                        }
                    }
                    return {
                        action: 'take',
                        amount: Math.max(1, Math.min(takeAmount, stonesRemaining)) // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
                    };
                } else {
                    // –í –º–∏–∑–µ—Ä–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±—Ä–∞—Ç–Ω–∞—è
                    if (stonesRemaining <= maxTake + 1) {
                        // –ï—Å–ª–∏ –æ—Å—Ç–∞–ª—Å—è —Ç–æ–ª—å–∫–æ 1 –∫–∞–º–µ–Ω—å, –∫–æ–º–ø—å—é—Ç–µ—Ä –≤—ã–Ω—É–∂–¥–µ–Ω –µ–≥–æ –≤–∑—è—Ç—å
                        if (stonesRemaining === 1) {
                            return {
                                action: 'take',
                                amount: 1
                            };
                        } else {
                            // –ï—Å–ª–∏ –∫–∞–º–Ω–µ–π –±–æ–ª—å—à–µ 1, –Ω–æ –º–µ–Ω—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ maxTake+1, –±–µ—Ä–µ–º –≤—Å–µ –∫—Ä–æ–º–µ –æ–¥–Ω–æ–≥–æ
                            let takeAmount = stonesRemaining - 1;
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –ª–∏ —ç—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
                            if (lastAddedAmount > 0 && takeAmount === lastAddedAmount) {
                                takeAmount = 1; // –ë–µ—Ä–µ–º –º–∏–Ω–∏–º—É–º
                            }
                            return {
                                action: 'take',
                                amount: takeAmount
                            };
                        }
                    } else {
                        const remainder = stonesRemaining % (maxTake + 1);
                        let takeAmount = remainder === 0 ? 1 : remainder;
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –ª–∏ —ç—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
                        if (lastAddedAmount > 0 && takeAmount === lastAddedAmount) {
                            // –ò—â–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
                            for (let i = 1; i <= Math.min(maxTake, stonesRemaining); i++) {
                                if (i !== lastAddedAmount) {
                                    takeAmount = i;
                                    break;
                                }
                            }
                        }
                        return {
                            action: 'take',
                            amount: takeAmount
                        };
                    }
                }
            } else {
                // –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞–º–Ω–µ–π
                if (playerAddHistory['computer']) {
                    // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –±–µ—Ä–µ–º
                    const remainder = stonesRemaining % (maxTake + 1);
                    let takeAmount = remainder === 0 ? Math.min(maxTake, stonesRemaining) : remainder;
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –ª–∏ —ç—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
                    if (lastAddedAmount > 0 && takeAmount === lastAddedAmount) {
                        // –ò—â–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
                        for (let i = 1; i <= Math.min(maxTake, stonesRemaining); i++) {
                            if (i !== lastAddedAmount) {
                                takeAmount = i;
                                break;
                            }
                        }
                    }
                    return {
                        action: 'take',
                        amount: Math.max(1, Math.min(takeAmount, stonesRemaining)) // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —á—Ç–æ –±–µ—Ä–µ–º –æ—Ç 1 –¥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
                    };
                } else {
                    // –ú–æ–∂–µ–º –≤—ã–±–∏—Ä–∞—Ç—å –º–µ–∂–¥—É –≤–∑—è—Ç–∏–µ–º –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º
                    const remainder = stonesRemaining % (maxTake + 1);
                    if (remainder === 0) {
                        // –ü–ª–æ—Ö–∞—è –ø–æ–∑–∏—Ü–∏—è, –ø–æ–ø—Ä–æ–±—É–µ–º –¥–æ–±–∞–≤–∏—Ç—å
                        return {
                            action: 'add',
                            amount: Math.max(1, Math.floor(Math.random() * maxTake) + 1) // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —á—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º –º–∏–Ω–∏–º—É–º 1
                        };
                    } else {
                        let takeAmount = Math.max(1, Math.min(remainder, stonesRemaining));
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –ª–∏ —ç—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
                        if (lastAddedAmount > 0 && takeAmount === lastAddedAmount) {
                            // –ò—â–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
                            for (let i = 1; i <= Math.min(maxTake, stonesRemaining); i++) {
                                if (i !== lastAddedAmount) {
                                    takeAmount = i;
                                    break;
                                }
                            }
                        }
                        return {
                            action: 'take',
                            amount: takeAmount // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
                        };
                    }
                }
            }
        }
        
        function endGame(winner) {
            gameActive = false;
            buttonsBlocked = true;
            takeButtons.innerHTML = '';
            addButtons.innerHTML = '';
            
            let winnerName, message;
            
            if (playerMode === 'vs_computer') {
                if (winner === 'computer') {
                    winnerName = '–ö–æ–º–ø—å—é—Ç–µ—Ä';
                } else {
                    winnerName = '–í—ã';
                }
            } else {
                winnerName = winner === 'player1' ? player1Name : player2Name;
            }
            
            if (gameMode === 'normal') {
                message = `${winnerName} –≤–∑—è–ª${winner === 'computer' || winner === 'player1' ? '' : '–∏'} –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–∞–º–µ–Ω—å! ${winnerName} –ø–æ–±–µ–¥–∏–ª${winner === 'computer' || winner === 'player1' ? '' : '–∏'}!`;
                messageDiv.className = 'message win';
            } else {
                message = `${winnerName} –≤–∑—è–ª${winner === 'computer' || winner === 'player1' ? '' : '–∏'} –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–∞–º–µ–Ω—å! ${winnerName} –ø—Ä–æ–∏–≥—Ä–∞–ª${winner === 'computer' || winner === 'player1' ? '' : '–∏'}!`;
                messageDiv.className = 'message lose';
            }
            
            messageDiv.textContent = message;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        updateGameDescription();
        updatePlayerModeSettings();
    </script>
</body>
</html>